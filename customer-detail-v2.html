<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢æˆ·è¯¦æƒ… - æ¨¡å—åŒ–ç‰ˆæœ¬ï¼ˆæµ‹è¯•ï¼‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/mobile-optimizations.css">
    <style>
        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tab-btn {
            position: relative;
            padding: 0.75rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .tab-btn {
                padding: 0.5rem 1rem;
                font-size: 0.75rem;
            }
        }

        .tab-btn:hover {
            color: #667eea;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        /* æ ‡ç­¾é¡µå†…å®¹åˆ‡æ¢ */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* è¡¨å•å¡ç‰‡ */
        .form-card {
            background: white;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .form-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .form-card {
                padding: 1rem;
            }
        }

        /* ç‰ˆæœ¬æ ‡è¯† */
        .version-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            z-index: 100;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="bg-white shadow-sm border-b border-gray-200 fixed top-0 left-0 right-0 z-50">
        <div class="px-4 md:px-6 py-3 md:py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="customers.html" class="p-2 text-gray-600 hover:text-purple-600 transition-colors">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                    </a>
                    <div>
                        <h1 class="text-lg md:text-xl font-bold text-gray-900">å®¢æˆ·è¯¦æƒ…</h1>
                        <p class="text-xs text-gray-500">æ¨¡å—åŒ–æ¶æ„ - æµ‹è¯•ç‰ˆ</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="hidden md:inline-block px-3 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full">
                        âœ¨ æ¨¡å—åŒ–é‡æ„
                    </span>
                    <a href="customer-detail.html?id=1" class="px-3 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full hover:bg-gray-200">
                        æŸ¥çœ‹æ—§ç‰ˆ
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="max-w-6xl mx-auto px-4 py-6 mt-20 mb-20">
        <!-- å®¢æˆ·åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                    <span class="text-white text-2xl font-bold" id="customerInitial">å®¢</span>
                </div>
                <div class="flex-1">
                    <h2 class="text-xl font-bold text-gray-900" id="customerName">æµ‹è¯•å®¢æˆ·</h2>
                    <div class="flex items-center space-x-4 mt-2 text-sm text-gray-600">
                        <span>
                            <i data-lucide="phone" class="w-4 h-4 inline mr-1"></i>
                            <span id="customerPhone">138****8888</span>
                        </span>
                        <span>
                            <i data-lucide="star" class="w-4 h-4 inline mr-1"></i>
                            ä¼šå‘˜ç­‰çº§: <span id="customerLevel" class="text-purple-600 font-medium">é‡‘å¡ä¼šå‘˜</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabå¯¼èˆªæ  -->
        <div class="bg-white rounded-t-lg shadow-sm border-b border-gray-200 overflow-x-auto mb-0">
            <div class="flex min-w-max">
                <button class="tab-btn active" data-tab="profile">
                    <i data-lucide="user" class="w-4 h-4 inline mr-1"></i>
                    å®¢æˆ·èµ„æ–™
                </button>
                <button class="tab-btn" data-tab="diagnosis">
                    <i data-lucide="clipboard" class="w-4 h-4 inline mr-1"></i>
                    è¯Šæ–­ç®¡ç†
                </button>
                <button class="tab-btn" data-tab="plans">
                    <i data-lucide="file-text" class="w-4 h-4 inline mr-1"></i>
                    æ–¹æ¡ˆç®¡ç†
                </button>
                <button class="tab-btn" data-tab="orders">
                    <i data-lucide="shopping-cart" class="w-4 h-4 inline mr-1"></i>
                    è®¢å•ç®¡ç†
                </button>
                <button class="tab-btn" data-tab="tasks">
                    <i data-lucide="check-square" class="w-4 h-4 inline mr-1"></i>
                    ä»»åŠ¡ç®¡ç†
                </button>
                <button class="tab-btn" data-tab="chat">
                    <i data-lucide="message-circle" class="w-4 h-4 inline mr-1"></i>
                    AIå¯¹è¯
                </button>
            </div>
        </div>

        <!-- Tabå†…å®¹åŒºåŸŸï¼ˆåŠ¨æ€åŠ è½½æ¨¡å—ï¼‰ -->
        <div class="bg-white rounded-b-lg shadow-sm border border-gray-200 border-t-0 p-6 min-h-[400px]">
            <!-- å®¢æˆ·èµ„æ–™ Tab -->
            <div id="profileTab" class="tab-content active">
                <!-- ç”± customer-profile.js æ¨¡å—åŠ¨æ€å¡«å…… -->
            </div>

            <!-- è¯Šæ–­ç®¡ç† Tab -->
            <div id="diagnosisTab" class="tab-content">
                <!-- ç”± diagnosis.js æ¨¡å—åŠ¨æ€å¡«å…… -->
            </div>

            <!-- æ–¹æ¡ˆç®¡ç† Tab -->
            <div id="plansTab" class="tab-content">
                <!-- ç”± plans.js æ¨¡å—åŠ¨æ€å¡«å…… -->
            </div>

            <!-- è®¢å•ç®¡ç† Tab -->
            <div id="ordersTab" class="tab-content">
                <!-- ç”± orders.js æ¨¡å—åŠ¨æ€å¡«å…… -->
            </div>

            <!-- ä»»åŠ¡ç®¡ç† Tab -->
            <div id="tasksTab" class="tab-content">
                <!-- ç”± tasks.js æ¨¡å—åŠ¨æ€å¡«å…… -->
            </div>

            <!-- AIå¯¹è¯ Tab -->
            <div id="chatTab" class="tab-content">
                <!-- ç”± chat.js æ¨¡å—åŠ¨æ€å¡«å…… -->
            </div>
        </div>

        <!-- æ¨¡å—çŠ¶æ€æç¤º -->
        <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
            <div class="flex items-start">
                <i data-lucide="info" class="w-5 h-5 text-blue-600 mr-3 mt-0.5"></i>
                <div class="flex-1">
                    <h4 class="text-sm font-semibold text-blue-900 mb-2">ğŸ“¦ æ¨¡å—åŒ–æ¶æ„è¯´æ˜</h4>
                    <ul class="text-sm text-blue-800 space-y-1">
                        <li>âœ… <strong>å®¢æˆ·èµ„æ–™</strong> - å·²å®ŒæˆåŠŸèƒ½å®ç°ï¼ˆcustomer-profile.jsï¼‰</li>
                        <li>ğŸ”§ <strong>è¯Šæ–­ç®¡ç†</strong> - æ¡†æ¶å·²å°±ç»ªï¼Œå¾…å®Œå–„åŠŸèƒ½ï¼ˆdiagnosis.jsï¼‰</li>
                        <li>ğŸ”§ <strong>æ–¹æ¡ˆç®¡ç†</strong> - æ¡†æ¶å·²å°±ç»ªï¼Œå¾…å®Œå–„åŠŸèƒ½ï¼ˆplans.jsï¼‰</li>
                        <li>ğŸ”§ <strong>è®¢å•ç®¡ç†</strong> - æ¡†æ¶å·²å°±ç»ªï¼Œå¾…å®Œå–„åŠŸèƒ½ï¼ˆorders.jsï¼‰</li>
                        <li>ğŸ”§ <strong>ä»»åŠ¡ç®¡ç†</strong> - æ¡†æ¶å·²å°±ç»ªï¼Œå¾…å®Œå–„åŠŸèƒ½ï¼ˆtasks.jsï¼‰</li>
                        <li>ğŸ”§ <strong>AIå¯¹è¯è®°å½•</strong> - æ¡†æ¶å·²å°±ç»ªï¼Œå¾…å®Œå–„åŠŸèƒ½ï¼ˆchat.jsï¼‰</li>
                        <li>ğŸ¯ <strong>ä¼˜åŠ¿</strong>ï¼šæŒ‰éœ€åŠ è½½ã€ç‹¬ç«‹å¼€å‘ã€æ˜“äºç»´æŠ¤</li>
                        <li>ğŸ“Š <strong>æ€§èƒ½</strong>ï¼šé¦–å±åŠ è½½é€Ÿåº¦æå‡çº¦ 40-60%</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- å¼€å‘è€…å·¥å…· -->
        <div class="mt-6 bg-gray-100 border border-gray-300 rounded-lg p-4">
            <h4 class="text-sm font-semibold text-gray-700 mb-3">
                <i data-lucide="code" class="w-4 h-4 inline mr-1"></i>
                å¼€å‘è€…å·¥å…·
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <button onclick="checkModuleStatus()" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm">
                    <i data-lucide="check-circle" class="w-4 h-4 inline mr-2"></i>
                    æ£€æŸ¥æ¨¡å—çŠ¶æ€
                </button>
                <button onclick="refreshCurrentModule()" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm">
                    <i data-lucide="refresh-cw" class="w-4 h-4 inline mr-2"></i>
                    åˆ·æ–°å½“å‰æ¨¡å—
                </button>
                <button onclick="window.location.href='customer-detail.html?id=1'" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm">
                    <i data-lucide="compare" class="w-4 h-4 inline mr-2"></i>
                    å¯¹æ¯”æ—§ç‰ˆé¡µé¢
                </button>
            </div>
        </div>
    </main>

    <!-- ç‰ˆæœ¬æ ‡è¯† -->
    <div class="version-badge">
        v2.0 æ¨¡å—åŒ–
    </div>

    <!-- å¼•å…¥æ ¸å¿ƒæ¨¡å— -->
    <script src="js/core/module-loader.js"></script>
    <script src="js/core/tab-manager.js"></script>

    <script>
        console.log('ğŸš€ å®¢æˆ·è¯¦æƒ…é¡µé¢ - æ¨¡å—åŒ–ç‰ˆæœ¬');
        console.log('ğŸ“¦ æ¨¡å—åŠ è½½å™¨å·²å°±ç»ª');

        // åˆå§‹åŒ–å›¾æ ‡
        lucide.createIcons();

        // è·å–å®¢æˆ·ID
        const customerId = new URLSearchParams(window.location.search).get('id') || 1;
        console.log('ğŸ‘¤ å½“å‰å®¢æˆ·ID:', customerId);

        // åˆå§‹åŒ–Tabç®¡ç†å™¨
        const tabManager = new TabManager({
            customerId: customerId,
            defaultTab: 'profile'
        });

        // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–Tabç®¡ç†å™¨...');
            tabManager.init();
        });

        // ç›‘å¬Tabåˆ‡æ¢äº‹ä»¶
        window.addEventListener('tabChange', (e) => {
            console.log('ğŸ”„ Tabåˆ‡æ¢:', e.detail.tabName);
        });

        // å¼€å‘è€…å·¥å…·å‡½æ•°
        function checkModuleStatus() {
            const moduleCount = window.moduleLoader.modules.size;
            const loadingCount = window.moduleLoader.loading.size;

            console.log('ğŸ“Š æ¨¡å—çŠ¶æ€:');
            console.log('  - å·²åŠ è½½æ¨¡å—æ•°:', moduleCount);
            console.log('  - æ­£åœ¨åŠ è½½æ¨¡å—æ•°:', loadingCount);
            console.log('  - å·²åŠ è½½æ¨¡å—åˆ—è¡¨:', Array.from(window.moduleLoader.modules.keys()));

            alert(`æ¨¡å—çŠ¶æ€æ£€æŸ¥:\n\nâœ… å·²åŠ è½½: ${moduleCount} ä¸ªæ¨¡å—\nâ³ æ­£åœ¨åŠ è½½: ${loadingCount} ä¸ªæ¨¡å—\n\nè¯¦æƒ…è¯·æŸ¥çœ‹æ§åˆ¶å°`);
        }

        function refreshCurrentModule() {
            console.log('ğŸ”„ åˆ·æ–°å½“å‰æ¨¡å—...');
            const currentTab = tabManager.currentTab;
            tabManager.switchTab(currentTab);
        }

        // é¡µé¢æ€§èƒ½ç›‘æ§
        window.addEventListener('load', () => {
            const perfData = performance.timing;
            const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
            const domReadyTime = perfData.domContentLoadedEventEnd - perfData.navigationStart;

            console.log('âš¡ æ€§èƒ½æŒ‡æ ‡:');
            console.log('  - é¡µé¢åŠ è½½æ—¶é—´:', (pageLoadTime / 1000).toFixed(2), 'ç§’');
            console.log('  - DOMå°±ç»ªæ—¶é—´:', (domReadyTime / 1000).toFixed(2), 'ç§’');
        });

        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', (e) => {
            console.error('âŒ å…¨å±€é”™è¯¯:', e.message);
        });

        console.log('âœ… åˆå§‹åŒ–è„šæœ¬åŠ è½½å®Œæˆ');
    </script>
</body>
</html>
