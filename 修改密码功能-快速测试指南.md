# 修改密码功能 - 快速测试指南

## 一、快速开始（5分钟测试）

### 1. 打开页面
```
http://localhost:3000/settings.html
```

### 2. 操作步骤
1. 点击"用户信息"标签
2. 点击"修改密码"按钮
3. 填写表单：
   - 当前密码: `password123`
   - 新密码: `Test@123456`
   - 确认密码: `Test@123456`
4. 点击"确认修改"

### 3. 预期结果
- ✅ 提示"密码修改成功，请使用新密码登录"
- ✅ 对话框自动关闭

---

## 二、功能测试检查清单

### 基础功能
- [ ] 点击"修改密码"按钮，对话框弹出
- [ ] 点击关闭按钮(X)，对话框关闭
- [ ] 点击"取消"按钮，对话框关闭
- [ ] 点击遮罩层外部，对话框关闭（可选）

### 密码可见性切换
- [ ] 点击眼睛图标，密码从隐藏变为可见
- [ ] 再次点击，密码从可见变为隐藏
- [ ] 图标在eye和eye-off之间切换

### 密码强度显示
输入不同密码，观察强度变化：
- [ ] `123456` → 很弱（红色）
- [ ] `abcd1234` → 弱（橙色）
- [ ] `Abcd1234` → 中等（黄色）
- [ ] `Abcd12345` → 强（蓝色）
- [ ] `Abcd@12345` → 很强（绿色）

### 密码匹配验证
- [ ] 确认密码为空时，不显示提示
- [ ] 确认密码与新密码不同，显示红色"两次输入的密码不一致"
- [ ] 确认密码与新密码相同，显示绿色"密码匹配"

### 表单验证
- [ ] 提交空表单 → 提示"请填写所有必填字段"
- [ ] 新密码少于6位 → 提示"新密码长度至少为6位"
- [ ] 两次密码不一致 → 提示"两次输入的密码不一致"
- [ ] 新旧密码相同 → 提示"新密码不能与当前密码相同"

### API调用
- [ ] 当前密码错误 → 提示"原密码错误"
- [ ] 当前密码正确 → 提示"密码修改成功"
- [ ] 服务器未启动 → 提示"网络错误，请稍后重试"

### 按钮状态
- [ ] 提交时按钮显示加载状态"修改中..."
- [ ] 提交时按钮不可点击
- [ ] 完成后按钮恢复正常状态

---

## 三、快速验证代码

### 验证模态框存在
打开浏览器控制台，输入：
```javascript
document.getElementById('change-password-modal')
```
应该返回一个元素对象（不是null）

### 验证函数存在
```javascript
typeof changePassword === 'function'
typeof closePasswordModal === 'function'
typeof updatePasswordStrength === 'function'
typeof checkPasswordMatch === 'function'
```
应该都返回true

### 验证API方法存在
```javascript
typeof userAPI.updatePassword === 'function'
```
应该返回true

---

## 四、常见问题排查

### 问题1: 点击"修改密码"没反应
**排查步骤**:
1. 打开浏览器控制台(F12)
2. 查看Console是否有错误
3. 检查changePassword函数是否存在

**解决方案**:
- 刷新页面（Ctrl+F5强制刷新）
- 清除浏览器缓存

### 问题2: 提交后一直加载
**排查步骤**:
1. 检查Network标签，看API请求状态
2. 检查后端服务是否运行

**解决方案**:
```bash
# 检查服务器
netstat -ano | findstr :3000

# 如果没运行，启动服务器
cd D:\work6\美业客户后台
node api/server.js
```

### 问题3: 提示"原密码错误"
**排查步骤**:
1. 确认当前用户的密码
2. 检查数据库中的密码哈希

**测试方案**:
```javascript
// 在浏览器控制台测试
const bcrypt = require('bcrypt');
const testPassword = 'password123';
// 注意：这只是示例，实际密码需要查数据库
```

### 问题4: 密码强度不显示
**排查步骤**:
1. 检查是否输入了新密码
2. 检查Console是否有错误

**解决方案**:
- 确保在"新密码"输入框输入内容
- 检查JavaScript是否正确加载

---

## 五、数据库验证

### 查看用户密码哈希
```bash
cd D:\work6\美业客户后台
node -e "const db = require('./api/config/db'); (async () => { const users = await db.query('SELECT id, username, password_hash FROM users WHERE id = 1'); console.log(users); process.exit(0); })()"
```

### 验证密码修改
修改密码前后运行上面的命令，观察password_hash是否改变

---

## 六、测试数据

### 测试用户
- ID: 1
- 用户名: admin
- 默认密码: password123（可能）

### 测试密码组合

#### 弱密码
- `123456`
- `abcdef`
- `qwerty`

#### 中等密码
- `Abc123`
- `Test1234`
- `Pass123`

#### 强密码
- `Test@123456`
- `MyP@ssw0rd`
- `Secure#2024`

---

## 七、性能检查

### 响应时间
- [ ] 打开对话框 < 100ms
- [ ] 密码强度更新 < 50ms
- [ ] 密码匹配检查 < 50ms
- [ ] API调用 < 1000ms

### 内存泄漏
1. 打开对话框
2. 关闭对话框
3. 重复10次
4. 检查浏览器内存使用（任务管理器）

---

## 八、安全检查

### XSS防护
尝试输入：
```
<script>alert('XSS')</script>
```
应该被正常处理，不执行脚本

### SQL注入防护
后端使用参数化查询，理论上安全

### 密码存储
- [ ] 密码使用bcrypt加密
- [ ] 数据库不存储明文密码
- [ ] 加密轮数 >= 10

---

## 九、浏览器兼容性

测试浏览器：
- [ ] Chrome (最新版)
- [ ] Firefox (最新版)
- [ ] Edge (最新版)
- [ ] Safari (如果可用)

测试功能：
- [ ] 对话框正常显示
- [ ] 密码强度显示正常
- [ ] API调用正常
- [ ] 提示消息显示正常

---

## 十、移动端测试

### 响应式检查
1. 打开Chrome开发者工具
2. 切换到设备模拟器
3. 选择不同设备（iPhone、iPad、Android）

### 测试项目
- [ ] 对话框在小屏幕上正常显示
- [ ] 输入框大小合适
- [ ] 按钮易于点击（>44px）
- [ ] 文字清晰可读

---

## 完成标准

当以下所有项目都通过时，功能测试完成：

✅ 基础功能（10/10）
✅ 密码可见性（3/3）
✅ 密码强度（5/5）
✅ 密码匹配（3/3）
✅ 表单验证（4/4）
✅ API调用（3/3）
✅ 按钮状态（3/3）
✅ 浏览器兼容（4/4）
✅ 移动端适配（4/4）

**总计**: 39/39 测试项通过

---

## 快速命令

### 启动服务器
```bash
cd D:\work6\美业客户后台
node api/server.js
```

### 查看日志
```bash
# 查看服务器输出
# 按Ctrl+C停止服务器
```

### 测试API
```bash
# 使用curl测试（需要先获取用户密码哈希）
curl -X PATCH http://localhost:3000/api/users/1/password \
  -H "Content-Type: application/json" \
  -d "{\"old_password\":\"password123\",\"new_password\":\"NewPass@123\"}"
```

---

**测试愉快！**

如有问题，请查看：
- `修改密码功能完成总结.md` - 完整技术文档
- `修改密码功能演示脚本.md` - 详细操作演示
- `修改密码功能测试说明.md` - 完整测试方案
