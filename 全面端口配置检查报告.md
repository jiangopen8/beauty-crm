# ğŸ” å…¨é¢ç«¯å£é…ç½®æ£€æŸ¥æŠ¥å‘Š

**æ£€æŸ¥æ—¶é—´**: 2025-12-05
**æ£€æŸ¥ç»“æœ**: âœ… å·²å…¨é¢ç»Ÿä¸€ä¸º 5004 ç«¯å£

---

## ğŸ“‹ æ£€æŸ¥é¡¹ç›®æ¸…å•

### âœ… æœ¬åœ°å¼€å‘ç¯å¢ƒé…ç½®

#### 1. ç¯å¢ƒé…ç½®æ–‡ä»¶ (.env)
```
APP_PORT=5004  âœ… å·²æ›´æ–°
APP_URL=http://localhost:5004  âœ… å·²æ›´æ–°
```

#### 2. åç«¯æœåŠ¡å¯åŠ¨æ–‡ä»¶ (api/server.js)
```javascript
// ä»ç¯å¢ƒå˜é‡è·å–ç«¯å£ï¼Œé»˜è®¤5004  âœ… å·²æ›´æ–°
const PORT = process.env.APP_PORT || 5004;
```

#### 3. PM2 é…ç½®æ–‡ä»¶ (ecosystem.config.js)
```javascript
env: {
  NODE_ENV: 'production',
  APP_PORT: 5004  âœ… å·²æ›´æ–°
}
```

#### 4. å‰ç«¯ API é…ç½®æ–‡ä»¶

**js/api.js**:
```javascript
// å¼€å‘ç¯å¢ƒ: http://localhost:5004  âœ… å·²æ›´æ–°
const API_BASE_URL = window.location.hostname === 'localhost'
  ? 'http://localhost:5004'
  : '';
```

**js/customerProfile.js**:
- `http://8.210.246.101:5004/api/customer-profile-templates`  âœ… å·²æ›´æ–°
- `http://8.210.246.101:5004/api/customer-profiles/customer/...`  âœ… å·²æ›´æ–°

**js/modules/customer-profile.js**:
- `http://localhost:5004`  âœ… å·²æ›´æ–°
- `http://8.210.246.101:5004`  âœ… å·²æ›´æ–°

#### 5. æµ‹è¯•è„šæœ¬

**scripts/create-test-franchisees.js**:
```javascript
const API_BASE_URL = process.env.API_BASE_URL || 'http://localhost:5004';  âœ… å·²æ›´æ–°
```

**test-create-private-template.js**:
```javascript
const API_BASE = 'http://localhost:5004';  âœ… å·²æ›´æ–°
```

**test-password-api.js**:
```javascript
const response = await fetchAPI(`http://localhost:5004/api/users/${userId}/password`, ...);  âœ… å·²æ›´æ–°
```

---

## ğŸ–¥ï¸ è¿œç¨‹æœåŠ¡å™¨ç«¯å£æƒ…å†µ

### å½“å‰ç›‘å¬ç«¯å£
```
ç«¯å£ 3000: LISTEN (Python æœåŠ¡ - å†å²é—ç•™)
ç«¯å£ 5002: LISTEN (Nginx å‰ç«¯)
ç«¯å£ 5004: LISTEN (Node.js æœåŠ¡ âœ…)
```

### ç«¯å£è¿›ç¨‹è¯¦æƒ…
```
Node.js åç«¯:
  PID: 933718
  Port: 5004
  Process: node /var/www/beauty-crm/api/server.js
  PM2 ID: 16
  PM2 Name: beauty-crm-nodejs
  Status: online âœ…
```

---

## ğŸ“Š é…ç½®ç»Ÿä¸€æƒ…å†µæ£€æŸ¥

| é…ç½®é¡¹ | ä½ç½® | æ—§å€¼ | æ–°å€¼ | çŠ¶æ€ |
|--------|------|------|------|------|
| APP_PORT | .env | 3000 | 5004 | âœ… |
| api/server.js | é»˜è®¤å€¼ | 3000 | 5004 | âœ… |
| ecosystem.config.js | PM2é…ç½® | 3000 | 5004 | âœ… |
| js/api.js | å‰ç«¯é…ç½® | 3000 | 5004 | âœ… |
| js/customerProfile.js | å®¢æˆ·èµ„æ–™ | 3000 | 5004 | âœ… |
| js/modules/customer-profile.js | æ–°æ¨¡å— | 3000 | 5004 | âœ… |
| scripts/create-test-franchisees.js | æµ‹è¯•è„šæœ¬ | 3000 | 5004 | âœ… |
| test-create-private-template.js | æµ‹è¯•è„šæœ¬ | 3000 | 5004 | âœ… |
| test-password-api.js | æµ‹è¯•è„šæœ¬ | 3000 | 5004 | âœ… |

---

## âœ… éªŒè¯ç»“æœ

### 1. åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸
```bash
SSHåˆ°è¿œç¨‹: pm2 logs beauty-crm-nodejs

è¾“å‡º:
âœ… æœåŠ¡å™¨è¿è¡Œä¸­...
   ç¯å¢ƒ: development
   ç«¯å£: 5004
   åœ°å€: http://localhost:5004
   å¥åº·æ£€æŸ¥: http://localhost:5004/health
   APIæ–‡æ¡£: http://localhost:5004/api
```

### 2. API ç«¯ç‚¹éªŒè¯
```bash
curl -s http://localhost:5004/api/customer-profile-templates

å“åº”: {"success":true,"data":[...]}  âœ…
```

### 3. è¿œç¨‹ç«¯å£ç›‘å¬
```bash
netstat -tulpn | grep 5004

tcp6 0 0 :::5004 :::* LISTEN 933718/node  âœ…
```

---

## ğŸ“ æ£€æŸ¥è¯´æ˜

### âœ… å·²ç»Ÿä¸€çš„ç«¯å£
- âœ… æœ¬åœ°å¼€å‘ç¯å¢ƒ: 5004
- âœ… è¿œç¨‹ç”Ÿäº§ç¯å¢ƒ: 5004
- âœ… æ‰€æœ‰å‰ç«¯æ¨¡å—: 5004
- âœ… æ‰€æœ‰æµ‹è¯•è„šæœ¬: 5004
- âœ… PM2 é…ç½®: 5004
- âœ… ç¯å¢ƒå˜é‡: 5004

### âš ï¸ éœ€è¦æ³¨æ„çš„äº‹é¡¹
1. **Python æœåŠ¡ (ç«¯å£ 3000)**
   - çŠ¶æ€: è¿è¡Œä¸­ä½†å·²å¼ƒç”¨
   - å»ºè®®: å¯ä»¥ä¿ç•™ä»¥é˜²éœ€è¦ï¼Œä¸å½±å“ Node.js æœåŠ¡

2. **Nginx (ç«¯å£ 5002)**
   - çŠ¶æ€: æ­£å¸¸è¿è¡Œï¼Œæä¾›å‰ç«¯æœåŠ¡
   - ä½œç”¨: æ‰˜ç®¡ HTML/CSS/JS é™æ€æ–‡ä»¶

3. **MySQL (ç«¯å£ 3306)**
   - çŠ¶æ€: è¿œç¨‹é˜¿é‡Œäº‘ RDS
   - çŠ¶æ€: è¿æ¥æ­£å¸¸

---

## ğŸš€ ç¡®è®¤ä¿¡æ¯

### ç³»ç»Ÿæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æµè§ˆå™¨è®¿é—® (ç”¨æˆ·)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Nginx 5002    â”‚
         â”‚  (å‰ç«¯æ–‡ä»¶)     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ API è°ƒç”¨åˆ°ç«¯å£ 5004  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Node.js 5004   â”‚
         â”‚ (åç«¯API)      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ MySQL 3306     â”‚
         â”‚ (é˜¿é‡Œäº‘ RDS)   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¿é—®æµç¨‹
```
1. ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨
2. è®¿é—® http://8.210.246.101:5002/
3. Nginx è¿”å› HTML/JS/CSS æ–‡ä»¶
4. å‰ç«¯ JS è°ƒç”¨ http://8.210.246.101:5004/api/...
5. Node.js å¤„ç†è¯·æ±‚å¹¶è¿”å›æ•°æ®
6. æ•°æ®åº“è¿”å›ç»“æœ
```

---

## ğŸ¯ æœ€ç»ˆçŠ¶æ€

### âœ… æ‰€æœ‰åç«¯ Node.js æœåŠ¡ç»Ÿä¸€ä½¿ç”¨ 5004 ç«¯å£
- âœ… ç¯å¢ƒé…ç½®ä¸€è‡´
- âœ… å‰ç«¯é…ç½®ä¸€è‡´
- âœ… æµ‹è¯•è„šæœ¬é…ç½®ä¸€è‡´
- âœ… æœåŠ¡è¿è¡Œæ­£å¸¸
- âœ… API ç«¯ç‚¹å¯ç”¨

### âœ… é…ç½®æ–‡ä»¶å·²åŒæ­¥åˆ°è¿œç¨‹
- âœ… .env å·²æ›´æ–°
- âœ… ecosystem.config.js å·²æ›´æ–°
- âœ… å‰ç«¯æ–‡ä»¶å·²æ›´æ–°
- âœ… Node.js æœåŠ¡å·²é‡å¯
- âœ… æ‰€æœ‰é…ç½®ç”Ÿæ•ˆ

---

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

| é¡¹ç›® | æ•°é‡ | çŠ¶æ€ |
|------|------|------|
| ä¿®æ”¹çš„é…ç½®æ–‡ä»¶ | 9 | âœ… |
| æ›´æ–°çš„ URL ç«¯å£ | 15+ | âœ… |
| éªŒè¯çš„ç«¯ç‚¹ | 3 | âœ… |
| æµ‹è¯•è„šæœ¬ | 3 | âœ… |

---

## ğŸ’¡ åç»­å»ºè®®

1. **å¯é€‰**: åœæ­¢æˆ–åˆ é™¤ Python æœåŠ¡ï¼ˆç«¯å£ 3000ï¼‰ä»¥é‡Šæ”¾èµ„æº
   ```bash
   kill 718966  # åœæ­¢ Python http.server
   ```

2. **æ¨è**: å®šæœŸæ£€æŸ¥ç«¯å£é…ç½®ä¸€è‡´æ€§
   ```bash
   grep -r ":3000\|:3001" . --include="*.js" --include=".env*"
   ```

3. **å»ºè®®**: æ–‡æ¡£ä¸­ç»Ÿä¸€è®°å½•ç«¯å£é…ç½®
   - å‰ç«¯: 5002 (Nginx)
   - åç«¯: 5004 (Node.js)
   - æ•°æ®åº“: 3306 (è¿œç¨‹ RDS)

---

**æ£€æŸ¥å®Œæˆæ—¥æœŸ**: 2025-12-05
**æ£€æŸ¥è€…**: ç³»ç»Ÿ
**çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡ï¼Œç³»ç»Ÿå°±ç»ª

