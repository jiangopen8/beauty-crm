# ç¾ä¸šå®¢æˆ·æ´å¯ŸCRMç³»ç»Ÿ - æ•°æ®åº“è¡¨ç»“æ„è¯´æ˜

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›®åç§° | ç¾ä¸šå®¢æˆ·æ´å¯ŸCRMç³»ç»Ÿ |
|---------|-------------------|
| æ–‡æ¡£ç‰ˆæœ¬ | v1.0 |
| åˆ›å»ºæ—¥æœŸ | 2025-12-01 |
| æ•°æ®åº“ç‰ˆæœ¬ | MySQL 8.0 |
| å­—ç¬¦é›† | utf8mb4 |
| å­˜å‚¨å¼•æ“ | InnoDB |

---

## ğŸ“Š è¡¨ç»“æ„æ¦‚è§ˆ

### ç»Ÿè®¡ä¿¡æ¯

| åˆ†ç±» | è¡¨æ•°é‡ | è¯´æ˜ |
|-----|--------|------|
| **ç»„ç»‡æœºæ„ç›¸å…³** | 1å¼  | organizations |
| **ç”¨æˆ·æƒé™ç›¸å…³** | 5å¼  | users, roles, permissions, user_roles, role_permissions |
| **å®¢æˆ·ç®¡ç†ç›¸å…³** | 3å¼  | customers, customer_diagnoses, customer_cases |
| **æœåŠ¡é¡¹ç›®ç›¸å…³** | 1å¼  | services |
| **è®¢å•ç®¡ç†ç›¸å…³** | 2å¼  | orders, order_items |
| **ä»»åŠ¡ç®¡ç†ç›¸å…³** | 1å¼  | tasks |
| **æ–¹æ¡ˆæ¨¡æ¿ç›¸å…³** | 1å¼  | solution_templates |
| **ç³»ç»Ÿæ—¥å¿—ç›¸å…³** | 1å¼  | operation_logs |
| **åˆè®¡** | **15å¼ ** | - |

### è¡¨æ¸…å•

```
1.  organizations          æœºæ„è¡¨
2.  users                  ç”¨æˆ·è¡¨
3.  roles                  è§’è‰²è¡¨
4.  user_roles             ç”¨æˆ·è§’è‰²å…³è”è¡¨
5.  permissions            æƒé™è¡¨
6.  role_permissions       è§’è‰²æƒé™å…³è”è¡¨
7.  customers              å®¢æˆ·è¡¨
8.  customer_diagnoses     å®¢æˆ·è¯Šæ–­è¡¨
9.  customer_cases         å®¢æˆ·æ¡ˆä¾‹è¡¨
10. services               æœåŠ¡é¡¹ç›®è¡¨
11. orders                 è®¢å•è¡¨
12. order_items            è®¢å•æ˜ç»†è¡¨
13. tasks                  ä»»åŠ¡è¡¨
14. solution_templates     æ–¹æ¡ˆæ¨¡æ¿è¡¨
15. operation_logs         æ“ä½œæ—¥å¿—è¡¨
```

---

## ä¸€ã€ç»„ç»‡æœºæ„ç›¸å…³è¡¨

### 1.1 organizations - æœºæ„è¡¨

**ç”¨é€”**ï¼šå­˜å‚¨æ€»éƒ¨ã€åŠ ç›Ÿå•†ã€é—¨åº—çš„ç»„ç»‡æ¶æ„ä¿¡æ¯

**ç‰¹ç‚¹**ï¼š
- è‡ªå…³è”è¡¨ï¼ˆparent_id â†’ organizations.idï¼‰
- æ”¯æŒä¸‰çº§å±‚çº§ï¼ˆæ€»éƒ¨â†’åŠ ç›Ÿå•†â†’é—¨åº—ï¼‰
- åŒ…å«åœ°ç†ä½ç½®ä¿¡æ¯ï¼ˆç»çº¬åº¦ï¼‰
- æ”¯æŒåŠ ç›Ÿå•†åˆåŒç®¡ç†

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **org_code** | VARCHAR(50) | NO | - | æœºæ„ç¼–ç ï¼ˆå”¯ä¸€ï¼‰ |
| **org_name** | VARCHAR(100) | NO | - | æœºæ„åç§° |
| **org_type** | ENUM | NO | - | æœºæ„ç±»å‹ï¼šplatform/franchisee/store |
| **parent_id** | BIGINT UNSIGNED | YES | NULL | ä¸Šçº§æœºæ„ID |
| **level** | TINYINT UNSIGNED | NO | 1 | å±‚çº§ï¼š1-æ€»éƒ¨/2-åŠ ç›Ÿå•†/3-é—¨åº— |
| **franchisee_level** | ENUM | YES | NULL | åŠ ç›Ÿå•†ç­‰çº§ï¼šflagship/standard/community |
| **contract_no** | VARCHAR(50) | YES | NULL | åˆåŒç¼–å· |
| **contract_start_date** | DATE | YES | NULL | åˆåŒå¼€å§‹æ—¥æœŸ |
| **contract_end_date** | DATE | YES | NULL | åˆåŒç»“æŸæ—¥æœŸ |
| **revenue_share_rate** | DECIMAL(5,2) | YES | 0.00 | åˆ†æˆæ¯”ä¾‹(%) |
| **contact_person** | VARCHAR(50) | YES | NULL | è”ç³»äºº |
| **contact_phone** | VARCHAR(20) | YES | NULL | è”ç³»ç”µè¯ |
| **contact_email** | VARCHAR(100) | YES | NULL | è”ç³»é‚®ç®± |
| **province** | VARCHAR(50) | YES | NULL | çœ |
| **city** | VARCHAR(50) | YES | NULL | å¸‚ |
| **district** | VARCHAR(50) | YES | NULL | åŒº |
| **address** | VARCHAR(200) | YES | NULL | è¯¦ç»†åœ°å€ |
| **longitude** | DECIMAL(10,6) | YES | NULL | ç»åº¦ |
| **latitude** | DECIMAL(10,6) | YES | NULL | çº¬åº¦ |
| **status** | ENUM | NO | active | çŠ¶æ€ï¼šactive/inactive/suspended |
| **logo_url** | VARCHAR(255) | YES | NULL | Logo URL |
| **description** | TEXT | YES | NULL | æœºæ„æè¿° |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| **updated_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| **created_by** | BIGINT UNSIGNED | YES | NULL | åˆ›å»ºäººID |
| **updated_by** | BIGINT UNSIGNED | YES | NULL | æ›´æ–°äººID |
| **is_deleted** | TINYINT(1) | NO | 0 | æ˜¯å¦åˆ é™¤ï¼š0-å¦/1-æ˜¯ |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| org_code | å”¯ä¸€ç´¢å¼• | org_code | æœºæ„ç¼–ç å”¯ä¸€ |
| idx_parent_id | æ™®é€šç´¢å¼• | parent_id | æŸ¥è¯¢å­æœºæ„ |
| idx_org_type | æ™®é€šç´¢å¼• | org_type | æŒ‰ç±»å‹æŸ¥è¯¢ |
| idx_status | æ™®é€šç´¢å¼• | status | æŒ‰çŠ¶æ€æŸ¥è¯¢ |
| idx_created_at | æ™®é€šç´¢å¼• | created_at | æŒ‰æ—¶é—´æŸ¥è¯¢ |

#### æšä¸¾å€¼è¯´æ˜

**org_type**:
- `platform` - æ€»éƒ¨
- `franchisee` - åŠ ç›Ÿå•†
- `store` - é—¨åº—

**franchisee_level**:
- `flagship` - æ——èˆ°åº—
- `standard` - æ ‡å‡†åº—
- `community` - ç¤¾åŒºåº—

**status**:
- `active` - æ­£å¸¸
- `inactive` - åœç”¨
- `suspended` - æš‚åœ

#### æ•°æ®ç¤ºä¾‹

```sql
-- æ€»éƒ¨
INSERT INTO organizations (org_code, org_name, org_type, level, status)
VALUES ('ORG000001', 'ç¾ä¸šCRMæ€»éƒ¨', 'platform', 1, 'active');

-- åŠ ç›Ÿå•†
INSERT INTO organizations (org_code, org_name, org_type, parent_id, level, franchisee_level)
VALUES ('ORG000002', 'ä¸Šæµ·åŠ ç›Ÿå•†A', 'franchisee', 1, 2, 'flagship');

-- é—¨åº—
INSERT INTO organizations (org_code, org_name, org_type, parent_id, level)
VALUES ('ORG000003', 'ä¸Šæµ·æµ¦ä¸œåº—', 'store', 2, 3);
```

---

## äºŒã€ç”¨æˆ·æƒé™ç›¸å…³è¡¨

### 2.1 users - ç”¨æˆ·è¡¨

**ç”¨é€”**ï¼šå­˜å‚¨ç³»ç»Ÿç”¨æˆ·ï¼ˆå‘˜å·¥ï¼‰çš„è´¦å·ä¿¡æ¯

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨bcryptåŠ å¯†å¯†ç 
- è®°å½•ç™»å½•ä¿¡æ¯ï¼ˆæœ€åç™»å½•æ—¶é—´ã€IPã€æ¬¡æ•°ï¼‰
- å…³è”æ‰€å±æœºæ„
- æ”¯æŒè´¦å·é”å®šåŠŸèƒ½

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **username** | VARCHAR(50) | NO | - | ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰ |
| **password_hash** | VARCHAR(255) | NO | - | å¯†ç å“ˆå¸Œï¼ˆbcryptï¼‰ |
| **real_name** | VARCHAR(50) | NO | - | çœŸå®å§“å |
| **org_id** | BIGINT UNSIGNED | NO | - | æ‰€å±æœºæ„IDï¼ˆå¤–é”®ï¼‰ |
| **phone** | VARCHAR(20) | YES | NULL | æ‰‹æœºå· |
| **email** | VARCHAR(100) | YES | NULL | é‚®ç®± |
| **gender** | ENUM | YES | NULL | æ€§åˆ«ï¼šmale/female/other |
| **avatar_url** | VARCHAR(255) | YES | NULL | å¤´åƒURL |
| **position** | VARCHAR(50) | YES | NULL | èŒä½ |
| **status** | ENUM | NO | active | çŠ¶æ€ï¼šactive/inactive/locked |
| **last_login_at** | TIMESTAMP | YES | NULL | æœ€åç™»å½•æ—¶é—´ |
| **last_login_ip** | VARCHAR(50) | YES | NULL | æœ€åç™»å½•IP |
| **login_count** | INT UNSIGNED | NO | 0 | ç™»å½•æ¬¡æ•° |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| **updated_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| **created_by** | BIGINT UNSIGNED | YES | NULL | åˆ›å»ºäººID |
| **updated_by** | BIGINT UNSIGNED | YES | NULL | æ›´æ–°äººID |
| **is_deleted** | TINYINT(1) | NO | 0 | æ˜¯å¦åˆ é™¤ |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| username | å”¯ä¸€ç´¢å¼• | username | ç”¨æˆ·åå”¯ä¸€ |
| idx_org_id | æ™®é€šç´¢å¼• | org_id | æŒ‰æœºæ„æŸ¥è¯¢ |
| idx_phone | æ™®é€šç´¢å¼• | phone | æŒ‰æ‰‹æœºå·æŸ¥è¯¢ |
| idx_status | æ™®é€šç´¢å¼• | status | æŒ‰çŠ¶æ€æŸ¥è¯¢ |
| idx_created_at | æ™®é€šç´¢å¼• | created_at | æŒ‰æ—¶é—´æŸ¥è¯¢ |

#### å¤–é”®

| å¤–é”®å | å…³è”è¡¨ | å…³è”å­—æ®µ | åˆ é™¤è§„åˆ™ |
|-------|--------|---------|---------|
| fk_users_org | organizations | org_id â†’ id | RESTRICT |

#### æšä¸¾å€¼è¯´æ˜

**gender**:
- `male` - ç”·
- `female` - å¥³
- `other` - å…¶ä»–

**status**:
- `active` - æ­£å¸¸
- `inactive` - åœç”¨
- `locked` - é”å®š

---

### 2.2 roles - è§’è‰²è¡¨

**ç”¨é€”**ï¼šå®šä¹‰ç³»ç»Ÿè§’è‰²ï¼ˆå¦‚ç®¡ç†å‘˜ã€åº—é•¿ã€é¡¾é—®ç­‰ï¼‰

**ç‰¹ç‚¹**ï¼š
- åŒ…å«æ•°æ®æƒé™èŒƒå›´ï¼ˆdata_scopeï¼‰
- é¢„è®¾7ç§è§’è‰²
- æ”¯æŒè‡ªå®šä¹‰è§’è‰²

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **role_code** | VARCHAR(50) | NO | - | è§’è‰²ç¼–ç ï¼ˆå”¯ä¸€ï¼‰ |
| **role_name** | VARCHAR(50) | NO | - | è§’è‰²åç§° |
| **description** | VARCHAR(200) | YES | NULL | è§’è‰²æè¿° |
| **data_scope** | ENUM | NO | self | æ•°æ®æƒé™ï¼šall/org/store/self |
| **status** | ENUM | NO | active | çŠ¶æ€ï¼šactive/inactive |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| **updated_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| **created_by** | BIGINT UNSIGNED | YES | NULL | åˆ›å»ºäººID |
| **is_deleted** | TINYINT(1) | NO | 0 | æ˜¯å¦åˆ é™¤ |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| role_code | å”¯ä¸€ç´¢å¼• | role_code | è§’è‰²ç¼–ç å”¯ä¸€ |
| idx_status | æ™®é€šç´¢å¼• | status | æŒ‰çŠ¶æ€æŸ¥è¯¢ |

#### æšä¸¾å€¼è¯´æ˜

**data_scope**ï¼ˆæ•°æ®æƒé™èŒƒå›´ï¼‰:
- `all` - å…¨éƒ¨æ•°æ®ï¼ˆè¶…çº§ç®¡ç†å‘˜ã€å¹³å°ç®¡ç†å‘˜ï¼‰
- `org` - æœ¬æœºæ„æ•°æ®ï¼ˆåŠ ç›Ÿå•†ç®¡ç†å‘˜ã€è´¢åŠ¡ï¼‰
- `store` - æœ¬é—¨åº—æ•°æ®ï¼ˆé—¨åº—åº—é•¿ï¼‰
- `self` - ä»…è‡ªå·±çš„æ•°æ®ï¼ˆç¾å®¹é¡¾é—®ã€ç¾å®¹å¸ˆï¼‰

**status**:
- `active` - å¯ç”¨
- `inactive` - åœç”¨

#### é¢„è®¾è§’è‰²

| role_code | role_name | data_scope | è¯´æ˜ |
|-----------|-----------|------------|------|
| super_admin | è¶…çº§ç®¡ç†å‘˜ | all | ç³»ç»Ÿæœ€é«˜æƒé™ |
| platform_admin | å¹³å°ç®¡ç†å‘˜ | all | æ€»éƒ¨ç®¡ç†å‘˜ |
| franchisee_admin | åŠ ç›Ÿå•†ç®¡ç†å‘˜ | org | ç®¡ç†æœ¬æœºæ„æ‰€æœ‰é—¨åº— |
| store_manager | é—¨åº—åº—é•¿ | store | ç®¡ç†æœ¬é—¨åº— |
| counselor | ç¾å®¹é¡¾é—® | self | æŸ¥çœ‹åˆ†é…çš„å®¢æˆ· |
| beautician | ç¾å®¹å¸ˆ | self | æŸ¥çœ‹åˆ†é…çš„è®¢å• |
| finance | è´¢åŠ¡äººå‘˜ | org | è´¢åŠ¡æ•°æ®æŸ¥çœ‹ |

---

### 2.3 user_roles - ç”¨æˆ·è§’è‰²å…³è”è¡¨

**ç”¨é€”**ï¼šå®ç°ç”¨æˆ·ä¸è§’è‰²çš„å¤šå¯¹å¤šå…³ç³»

**ç‰¹ç‚¹**ï¼š
- ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè§’è‰²
- ä¸€ä¸ªè§’è‰²å¯ä»¥åˆ†é…ç»™å¤šä¸ªç”¨æˆ·

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **user_id** | BIGINT UNSIGNED | NO | - | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ |
| **role_id** | BIGINT UNSIGNED | NO | - | è§’è‰²IDï¼ˆå¤–é”®ï¼‰ |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| **created_by** | BIGINT UNSIGNED | YES | NULL | åˆ›å»ºäººID |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| uk_user_role | å”¯ä¸€ç´¢å¼• | (user_id, role_id) | é˜²æ­¢é‡å¤åˆ†é… |
| idx_role_id | æ™®é€šç´¢å¼• | role_id | æŒ‰è§’è‰²æŸ¥è¯¢ç”¨æˆ· |

#### å¤–é”®

| å¤–é”®å | å…³è”è¡¨ | å…³è”å­—æ®µ | åˆ é™¤è§„åˆ™ |
|-------|--------|---------|---------|
| fk_user_roles_user | users | user_id â†’ id | CASCADE |
| fk_user_roles_role | roles | role_id â†’ id | CASCADE |

---

### 2.4 permissions - æƒé™è¡¨

**ç”¨é€”**ï¼šå®šä¹‰ç³»ç»Ÿæƒé™ï¼ˆèœå•ã€æŒ‰é’®ã€APIï¼‰

**ç‰¹ç‚¹**ï¼š
- æ”¯æŒæ ‘å½¢ç»“æ„ï¼ˆparent_idï¼‰
- åŒºåˆ†èµ„æºç±»å‹ï¼ˆmenu/button/apiï¼‰
- åŒ…å«è·¯ç”±è·¯å¾„å’Œå›¾æ ‡

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **permission_code** | VARCHAR(100) | NO | - | æƒé™ç¼–ç ï¼ˆå”¯ä¸€ï¼‰ |
| **permission_name** | VARCHAR(100) | NO | - | æƒé™åç§° |
| **resource_type** | ENUM | NO | - | èµ„æºç±»å‹ï¼šmenu/button/api |
| **parent_id** | BIGINT UNSIGNED | YES | NULL | çˆ¶æƒé™ID |
| **route_path** | VARCHAR(200) | YES | NULL | è·¯ç”±è·¯å¾„ |
| **icon** | VARCHAR(50) | YES | NULL | å›¾æ ‡ |
| **sort_order** | INT UNSIGNED | NO | 0 | æ’åº |
| **status** | ENUM | NO | active | çŠ¶æ€ï¼šactive/inactive |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| **updated_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| **is_deleted** | TINYINT(1) | NO | 0 | æ˜¯å¦åˆ é™¤ |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| permission_code | å”¯ä¸€ç´¢å¼• | permission_code | æƒé™ç¼–ç å”¯ä¸€ |
| idx_parent_id | æ™®é€šç´¢å¼• | parent_id | æŸ¥è¯¢å­æƒé™ |
| idx_resource_type | æ™®é€šç´¢å¼• | resource_type | æŒ‰ç±»å‹æŸ¥è¯¢ |

#### æšä¸¾å€¼è¯´æ˜

**resource_type**:
- `menu` - èœå•æƒé™
- `button` - æŒ‰é’®æƒé™
- `api` - APIæ¥å£æƒé™

**status**:
- `active` - å¯ç”¨
- `inactive` - åœç”¨

#### é¢„è®¾æƒé™ï¼ˆèœå•ï¼‰

| permission_code | permission_name | route_path | icon | sort_order |
|----------------|-----------------|------------|------|-----------|
| dashboard | æ•°æ®çœ‹æ¿ | /index.html | home | 1 |
| customers | å®¢æˆ·ç®¡ç† | /customers.html | users | 2 |
| orders | è®¢å•ç®¡ç† | /orders.html | shopping-cart | 3 |
| tasks | ä»»åŠ¡ç®¡ç† | /tasks.html | clipboard-list | 4 |
| cases | å®¢æˆ·æ¡ˆä¾‹ | /cases.html | image | 5 |
| templates | æ–¹æ¡ˆæ¨¡æ¿ | /templates.html | layers | 6 |
| franchisees | åŠ ç›Ÿå•†ç®¡ç† | /franchisees.html | building | 7 |
| settings | ç³»ç»Ÿè®¾ç½® | /settings.html | settings | 8 |

---

### 2.5 role_permissions - è§’è‰²æƒé™å…³è”è¡¨

**ç”¨é€”**ï¼šå®ç°è§’è‰²ä¸æƒé™çš„å¤šå¯¹å¤šå…³ç³»

**ç‰¹ç‚¹**ï¼š
- ä¸€ä¸ªè§’è‰²å¯ä»¥æœ‰å¤šä¸ªæƒé™
- ä¸€ä¸ªæƒé™å¯ä»¥åˆ†é…ç»™å¤šä¸ªè§’è‰²

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **role_id** | BIGINT UNSIGNED | NO | - | è§’è‰²IDï¼ˆå¤–é”®ï¼‰ |
| **permission_id** | BIGINT UNSIGNED | NO | - | æƒé™IDï¼ˆå¤–é”®ï¼‰ |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| **created_by** | BIGINT UNSIGNED | YES | NULL | åˆ›å»ºäººID |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| uk_role_permission | å”¯ä¸€ç´¢å¼• | (role_id, permission_id) | é˜²æ­¢é‡å¤åˆ†é… |
| idx_permission_id | æ™®é€šç´¢å¼• | permission_id | æŒ‰æƒé™æŸ¥è¯¢è§’è‰² |

#### å¤–é”®

| å¤–é”®å | å…³è”è¡¨ | å…³è”å­—æ®µ | åˆ é™¤è§„åˆ™ |
|-------|--------|---------|---------|
| fk_role_perms_role | roles | role_id â†’ id | CASCADE |
| fk_role_perms_perm | permissions | permission_id â†’ id | CASCADE |

---

## ä¸‰ã€å®¢æˆ·ç®¡ç†ç›¸å…³è¡¨

### 3.1 customers - å®¢æˆ·è¡¨

**ç”¨é€”**ï¼šå­˜å‚¨å®¢æˆ·åŸºæœ¬ä¿¡æ¯å’Œä¼šå‘˜ä¿¡æ¯

**ç‰¹ç‚¹**ï¼š
- æ”¯æŒå®¢æˆ·æ ‡ç­¾ï¼ˆJSONå­—æ®µï¼‰
- è®°å½•ç´¯è®¡æ¶ˆè´¹å’Œè®¢å•æ•°
- å…³è”ä¸“å±é¡¾é—®
- æ”¯æŒæ¨èäººå…³ç³»
- æ•æ„Ÿæ•°æ®åŠ å¯†ï¼ˆèº«ä»½è¯å·ï¼‰

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **customer_no** | VARCHAR(50) | NO | - | å®¢æˆ·ç¼–å·ï¼ˆå”¯ä¸€ï¼‰ |
| **name** | VARCHAR(50) | NO | - | å§“å |
| **gender** | ENUM | YES | NULL | æ€§åˆ«ï¼šmale/female |
| **birth_date** | DATE | YES | NULL | å‡ºç”Ÿæ—¥æœŸ |
| **phone** | VARCHAR(20) | NO | - | æ‰‹æœºå· |
| **id_card** | VARCHAR(255) | YES | NULL | èº«ä»½è¯å·ï¼ˆAESåŠ å¯†ï¼‰ |
| **province** | VARCHAR(50) | YES | NULL | çœ |
| **city** | VARCHAR(50) | YES | NULL | å¸‚ |
| **district** | VARCHAR(50) | YES | NULL | åŒº |
| **address** | VARCHAR(200) | YES | NULL | è¯¦ç»†åœ°å€ |
| **org_id** | BIGINT UNSIGNED | NO | - | æ‰€å±æœºæ„IDï¼ˆå¤–é”®ï¼‰ |
| **store_id** | BIGINT UNSIGNED | NO | - | æ‰€å±é—¨åº—IDï¼ˆå¤–é”®ï¼‰ |
| **counselor_id** | BIGINT UNSIGNED | YES | NULL | ä¸“å±é¡¾é—®IDï¼ˆå¤–é”®ï¼‰ |
| **source_channel** | ENUM | YES | walk_in | æ¥æºæ¸ é“ |
| **referrer_id** | BIGINT UNSIGNED | YES | NULL | æ¨èäººID |
| **member_level** | ENUM | NO | normal | ä¼šå‘˜ç­‰çº§ |
| **member_points** | INT UNSIGNED | NO | 0 | ä¼šå‘˜ç§¯åˆ† |
| **tags** | JSON | YES | NULL | å®¢æˆ·æ ‡ç­¾ï¼ˆJSONæ•°ç»„ï¼‰ |
| **total_consumption** | DECIMAL(10,2) | NO | 0.00 | ç´¯è®¡æ¶ˆè´¹é‡‘é¢ |
| **total_orders** | INT UNSIGNED | NO | 0 | ç´¯è®¡è®¢å•æ•° |
| **last_visit_at** | TIMESTAMP | YES | NULL | æœ€ååˆ°åº—æ—¶é—´ |
| **remark** | TEXT | YES | NULL | å¤‡æ³¨ |
| **status** | ENUM | NO | active | çŠ¶æ€ï¼šactive/inactive/blacklist |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| **updated_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| **created_by** | BIGINT UNSIGNED | YES | NULL | åˆ›å»ºäººID |
| **updated_by** | BIGINT UNSIGNED | YES | NULL | æ›´æ–°äººID |
| **is_deleted** | TINYINT(1) | NO | 0 | æ˜¯å¦åˆ é™¤ |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| customer_no | å”¯ä¸€ç´¢å¼• | customer_no | å®¢æˆ·ç¼–å·å”¯ä¸€ |
| idx_phone | æ™®é€šç´¢å¼• | phone | æŒ‰æ‰‹æœºå·æŸ¥è¯¢ |
| idx_org_id | æ™®é€šç´¢å¼• | org_id | æŒ‰æœºæ„æŸ¥è¯¢ |
| idx_store_id | æ™®é€šç´¢å¼• | store_id | æŒ‰é—¨åº—æŸ¥è¯¢ |
| idx_counselor_id | æ™®é€šç´¢å¼• | counselor_id | æŒ‰é¡¾é—®æŸ¥è¯¢ |
| idx_member_level | æ™®é€šç´¢å¼• | member_level | æŒ‰ä¼šå‘˜ç­‰çº§æŸ¥è¯¢ |
| idx_status | æ™®é€šç´¢å¼• | status | æŒ‰çŠ¶æ€æŸ¥è¯¢ |
| idx_created_at | æ™®é€šç´¢å¼• | created_at | æŒ‰æ—¶é—´æŸ¥è¯¢ |

#### å¤–é”®

| å¤–é”®å | å…³è”è¡¨ | å…³è”å­—æ®µ | åˆ é™¤è§„åˆ™ |
|-------|--------|---------|---------|
| fk_customers_org | organizations | org_id â†’ id | RESTRICT |
| fk_customers_store | organizations | store_id â†’ id | RESTRICT |
| fk_customers_counselor | users | counselor_id â†’ id | SET NULL |

#### æšä¸¾å€¼è¯´æ˜

**gender**:
- `male` - ç”·
- `female` - å¥³

**source_channel**ï¼ˆæ¥æºæ¸ é“ï¼‰:
- `walk_in` - è‡ªç„¶è¿›åº—
- `referral` - æ¨è
- `online` - çº¿ä¸Šè·å®¢
- `event` - æ´»åŠ¨
- `other` - å…¶ä»–

**member_level**ï¼ˆä¼šå‘˜ç­‰çº§ï¼‰:
- `normal` - æ™®é€šä¼šå‘˜
- `silver` - é“¶å¡ä¼šå‘˜
- `gold` - é‡‘å¡ä¼šå‘˜
- `platinum` - ç™½é‡‘ä¼šå‘˜
- `diamond` - é’»çŸ³ä¼šå‘˜

**status**:
- `active` - æ­£å¸¸
- `inactive` - åœç”¨
- `blacklist` - é»‘åå•

#### JSONå­—æ®µè¯´æ˜

**tags**ï¼ˆå®¢æˆ·æ ‡ç­¾ï¼‰ç¤ºä¾‹ï¼š
```json
["é«˜ä»·å€¼å®¢æˆ·", "æ•æ„Ÿè‚Œ", "å­•å¦‡", "VIP"]
```

---

### 3.2 customer_diagnoses - å®¢æˆ·è¯Šæ–­è¡¨

**ç”¨é€”**ï¼šè®°å½•å®¢æˆ·çš„çš®è‚¤/æ¯›å‘è¯Šæ–­æ•°æ®

**ç‰¹ç‚¹**ï¼š
- æ”¯æŒçš®è‚¤å’Œæ¯›å‘åŒé‡è¯Šæ–­
- JSONå­—æ®µå­˜å‚¨è¯¦ç»†è¯Šæ–­æ•°æ®
- å…³è”è¯Šæ–­ç…§ç‰‡
- è®°å½•è¯Šæ–­å»ºè®®

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **customer_id** | BIGINT UNSIGNED | NO | - | å®¢æˆ·IDï¼ˆå¤–é”®ï¼‰ |
| **org_id** | BIGINT UNSIGNED | NO | - | æ‰€å±æœºæ„ID |
| **diagnose_date** | DATE | NO | - | è¯Šæ–­æ—¥æœŸ |
| **diagnosed_by** | BIGINT UNSIGNED | NO | - | è¯Šæ–­äººIDï¼ˆå¤–é”®ï¼‰ |
| **skin_type** | ENUM | YES | NULL | è‚¤è´¨ç±»å‹ |
| **skin_problems** | JSON | YES | NULL | çš®è‚¤é—®é¢˜ï¼ˆJSONæ•°ç»„ï¼‰ |
| **skin_sensitivity** | JSON | YES | NULL | æ•æ„Ÿæºï¼ˆJSONæ•°ç»„ï¼‰ |
| **hair_type** | ENUM | YES | NULL | å‘è´¨ç±»å‹ |
| **hair_problems** | JSON | YES | NULL | æ¯›å‘é—®é¢˜ï¼ˆJSONæ•°ç»„ï¼‰ |
| **scalp_condition** | VARCHAR(100) | YES | NULL | å¤´çš®çŠ¶å†µ |
| **diagnose_data** | JSON | YES | NULL | è¯¦ç»†è¯Šæ–­æ•°æ® |
| **photos** | JSON | YES | NULL | è¯Šæ–­ç…§ç‰‡URLsï¼ˆJSONæ•°ç»„ï¼‰ |
| **suggestions** | TEXT | YES | NULL | è¯Šæ–­å»ºè®® |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| **updated_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| **created_by** | BIGINT UNSIGNED | YES | NULL | åˆ›å»ºäººID |
| **is_deleted** | TINYINT(1) | NO | 0 | æ˜¯å¦åˆ é™¤ |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| idx_customer_id | æ™®é€šç´¢å¼• | customer_id | æŒ‰å®¢æˆ·æŸ¥è¯¢ |
| idx_org_id | æ™®é€šç´¢å¼• | org_id | æŒ‰æœºæ„æŸ¥è¯¢ |
| idx_diagnose_date | æ™®é€šç´¢å¼• | diagnose_date | æŒ‰æ—¥æœŸæŸ¥è¯¢ |

#### å¤–é”®

| å¤–é”®å | å…³è”è¡¨ | å…³è”å­—æ®µ | åˆ é™¤è§„åˆ™ |
|-------|--------|---------|---------|
| fk_diagnoses_customer | customers | customer_id â†’ id | CASCADE |
| fk_diagnoses_user | users | diagnosed_by â†’ id | RESTRICT |

#### æšä¸¾å€¼è¯´æ˜

**skin_type**ï¼ˆè‚¤è´¨ç±»å‹ï¼‰:
- `dry` - å¹²æ€§
- `oily` - æ²¹æ€§
- `combination` - æ··åˆæ€§
- `sensitive` - æ•æ„Ÿæ€§
- `normal` - ä¸­æ€§

**hair_type**ï¼ˆå‘è´¨ç±»å‹ï¼‰:
- `dry` - å¹²æ€§
- `oily` - æ²¹æ€§
- `normal` - ä¸­æ€§
- `damaged` - å—æŸ

#### JSONå­—æ®µç¤ºä¾‹

**skin_problems**ï¼ˆçš®è‚¤é—®é¢˜ï¼‰:
```json
["ç—˜ç—˜", "è‰²æ–‘", "æ¯›å­”ç²—å¤§", "ç»†çº¹"]
```

**skin_sensitivity**ï¼ˆæ•æ„Ÿæºï¼‰:
```json
["é…’ç²¾", "é¦™ç²¾", "é˜²è…å‰‚"]
```

**hair_problems**ï¼ˆæ¯›å‘é—®é¢˜ï¼‰:
```json
["è„±å‘", "åˆ†å‰", "å¹²æ¯", "å¤´å±‘"]
```

**photos**ï¼ˆè¯Šæ–­ç…§ç‰‡ï¼‰:
```json
[
  "https://oss.example.com/diagnosis/2025/12/01/photo1.jpg",
  "https://oss.example.com/diagnosis/2025/12/01/photo2.jpg"
]
```

**diagnose_data**ï¼ˆè¯¦ç»†è¯Šæ–­æ•°æ®ï¼‰:
```json
{
  "moisture": 35,
  "oil": 60,
  "elasticity": 75,
  "pore_size": "medium",
  "wrinkle_level": "light"
}
```

---

### 3.3 customer_cases - å®¢æˆ·æ¡ˆä¾‹è¡¨

**ç”¨é€”**ï¼šå­˜å‚¨æˆåŠŸå®¢æˆ·æ¡ˆä¾‹ï¼Œç”¨äºå±•ç¤ºå’Œè¥é”€

**ç‰¹ç‚¹**ï¼š
- å‰åå¯¹æ¯”ç…§ç‰‡
- å®¢æˆ·è¯„ä»·å’Œæ»¡æ„åº¦
- æ”¯æŒç²¾é€‰å’Œå…¬å¼€å±•ç¤º
- å¯ä½œä¸ºè¥é”€ç´ æ

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **customer_id** | BIGINT UNSIGNED | NO | - | å®¢æˆ·IDï¼ˆå¤–é”®ï¼‰ |
| **org_id** | BIGINT UNSIGNED | NO | - | æ‰€å±æœºæ„ID |
| **case_title** | VARCHAR(200) | NO | - | æ¡ˆä¾‹æ ‡é¢˜ |
| **case_type** | ENUM | NO | - | æ¡ˆä¾‹ç±»å‹ |
| **service_period** | VARCHAR(50) | YES | NULL | æœåŠ¡å‘¨æœŸï¼ˆå¦‚ï¼š3ä¸ªæœˆï¼‰ |
| **service_frequency** | VARCHAR(50) | YES | NULL | æœåŠ¡é¢‘æ¬¡ï¼ˆå¦‚ï¼šæ¯å‘¨2æ¬¡ï¼‰ |
| **initial_problems** | TEXT | YES | NULL | åˆå§‹é—®é¢˜æè¿° |
| **treatment_plan** | TEXT | YES | NULL | æ²»ç–—æ–¹æ¡ˆ |
| **products_used** | JSON | YES | NULL | ä½¿ç”¨äº§å“ï¼ˆJSONæ•°ç»„ï¼‰ |
| **results** | TEXT | YES | NULL | æ•ˆæœè¯´æ˜ |
| **before_photos** | JSON | YES | NULL | å‰ç…§ç‰‡URLs |
| **after_photos** | JSON | YES | NULL | åç…§ç‰‡URLs |
| **customer_feedback** | TEXT | YES | NULL | å®¢æˆ·è¯„ä»· |
| **satisfaction_score** | TINYINT UNSIGNED | YES | NULL | æ»¡æ„åº¦è¯„åˆ†ï¼ˆ1-5ï¼‰ |
| **is_featured** | TINYINT(1) | NO | 0 | æ˜¯å¦ç²¾é€‰ |
| **is_public** | TINYINT(1) | NO | 0 | æ˜¯å¦å…¬å¼€å±•ç¤º |
| **display_order** | INT UNSIGNED | NO | 0 | å±•ç¤ºé¡ºåº |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| **updated_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| **created_by** | BIGINT UNSIGNED | YES | NULL | åˆ›å»ºäººID |
| **updated_by** | BIGINT UNSIGNED | YES | NULL | æ›´æ–°äººID |
| **is_deleted** | TINYINT(1) | NO | 0 | æ˜¯å¦åˆ é™¤ |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| idx_customer_id | æ™®é€šç´¢å¼• | customer_id | æŒ‰å®¢æˆ·æŸ¥è¯¢ |
| idx_org_id | æ™®é€šç´¢å¼• | org_id | æŒ‰æœºæ„æŸ¥è¯¢ |
| idx_case_type | æ™®é€šç´¢å¼• | case_type | æŒ‰ç±»å‹æŸ¥è¯¢ |
| idx_is_featured | æ™®é€šç´¢å¼• | is_featured | æŸ¥è¯¢ç²¾é€‰æ¡ˆä¾‹ |
| idx_is_public | æ™®é€šç´¢å¼• | is_public | æŸ¥è¯¢å…¬å¼€æ¡ˆä¾‹ |

#### å¤–é”®

| å¤–é”®å | å…³è”è¡¨ | å…³è”å­—æ®µ | åˆ é™¤è§„åˆ™ |
|-------|--------|---------|---------|
| fk_cases_customer | customers | customer_id â†’ id | CASCADE |

#### æšä¸¾å€¼è¯´æ˜

**case_type**ï¼ˆæ¡ˆä¾‹ç±»å‹ï¼‰:
- `skin_care` - çš®è‚¤æŠ¤ç†
- `hair_care` - æ¯›å‘æŠ¤ç†
- `body_care` - èº«ä½“æŠ¤ç†
- `other` - å…¶ä»–

#### JSONå­—æ®µç¤ºä¾‹

**products_used**ï¼ˆä½¿ç”¨äº§å“ï¼‰:
```json
["ç»å°¿é…¸ç²¾åæ¶²", "èƒ¶åŸè›‹ç™½é¢è†œ", "ç»´Cç¾ç™½ç²¾å"]
```

**before_photos**ï¼ˆå‰ç…§ç‰‡ï¼‰:
```json
[
  "https://oss.example.com/cases/before_1.jpg",
  "https://oss.example.com/cases/before_2.jpg"
]
```

**after_photos**ï¼ˆåç…§ç‰‡ï¼‰:
```json
[
  "https://oss.example.com/cases/after_1.jpg",
  "https://oss.example.com/cases/after_2.jpg"
]
```

---

## å››ã€æœåŠ¡é¡¹ç›®ç›¸å…³è¡¨

### 4.1 services - æœåŠ¡é¡¹ç›®è¡¨

**ç”¨é€”**ï¼šå®šä¹‰å¯æä¾›çš„æœåŠ¡é¡¹ç›®

**ç‰¹ç‚¹**ï¼š
- æ”¯æŒå…¨å±€å’Œæœºæ„çº§æœåŠ¡
- åŒ…å«ä»·æ ¼ï¼ˆæ ‡å‡†ä»·/VIPä»·ï¼‰
- æœåŠ¡æ—¶é•¿ç®¡ç†
- é€‚ç”¨äººç¾¤æ ‡ç­¾

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **service_code** | VARCHAR(50) | NO | - | é¡¹ç›®ç¼–ç  |
| **service_name** | VARCHAR(100) | NO | - | é¡¹ç›®åç§° |
| **category** | ENUM | NO | - | æœåŠ¡ç±»åˆ« |
| **subcategory** | VARCHAR(50) | YES | NULL | å­ç±»åˆ« |
| **org_id** | BIGINT UNSIGNED | YES | NULL | æ‰€å±æœºæ„IDï¼ˆNULL=å…¨å±€ï¼‰ |
| **standard_price** | DECIMAL(10,2) | NO | - | æ ‡å‡†ä»·æ ¼ |
| **vip_price** | DECIMAL(10,2) | YES | NULL | VIPä»·æ ¼ |
| **duration_minutes** | INT UNSIGNED | NO | 60 | æœåŠ¡æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ |
| **description** | TEXT | YES | NULL | é¡¹ç›®æè¿° |
| **benefits** | TEXT | YES | NULL | åŠŸæ•ˆè¯´æ˜ |
| **suitable_for** | JSON | YES | NULL | é€‚ç”¨äººç¾¤ï¼ˆJSONï¼‰ |
| **cover_image** | VARCHAR(255) | YES | NULL | å°é¢å›¾ |
| **is_featured** | TINYINT(1) | NO | 0 | æ˜¯å¦æ¨è |
| **display_order** | INT UNSIGNED | NO | 0 | æ’åº |
| **status** | ENUM | NO | active | çŠ¶æ€ï¼šactive/inactive |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| **updated_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| **created_by** | BIGINT UNSIGNED | YES | NULL | åˆ›å»ºäººID |
| **updated_by** | BIGINT UNSIGNED | YES | NULL | æ›´æ–°äººID |
| **is_deleted** | TINYINT(1) | NO | 0 | æ˜¯å¦åˆ é™¤ |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| uk_org_code | å”¯ä¸€ç´¢å¼• | (org_id, service_code) | æœºæ„å†…ç¼–ç å”¯ä¸€ |
| idx_category | æ™®é€šç´¢å¼• | category | æŒ‰ç±»åˆ«æŸ¥è¯¢ |
| idx_status | æ™®é€šç´¢å¼• | status | æŒ‰çŠ¶æ€æŸ¥è¯¢ |
| idx_org_id | æ™®é€šç´¢å¼• | org_id | æŒ‰æœºæ„æŸ¥è¯¢ |

#### æšä¸¾å€¼è¯´æ˜

**category**ï¼ˆæœåŠ¡ç±»åˆ«ï¼‰:
- `skin_care` - çš®è‚¤æŠ¤ç†
- `hair_care` - æ¯›å‘æŠ¤ç†
- `body_care` - èº«ä½“æŠ¤ç†
- `spa` - SPA
- `other` - å…¶ä»–

**status**:
- `active` - å¯ç”¨
- `inactive` - åœç”¨

#### JSONå­—æ®µç¤ºä¾‹

**suitable_for**ï¼ˆé€‚ç”¨äººç¾¤ï¼‰:
```json
{
  "skin_types": ["dry", "sensitive"],
  "age_range": "25-45",
  "concerns": ["wrinkles", "dark_spots"]
}
```

#### é¢„è®¾æœåŠ¡é¡¹ç›®

| service_code | service_name | category | standard_price | duration_minutes |
|-------------|--------------|----------|----------------|-----------------|
| SV001 | æ·±å±‚è¡¥æ°´æŠ¤ç† | skin_care | 299.00 | 60 |
| SV002 | ç¾ç™½æ·¡æ–‘å¥—é¤ | skin_care | 599.00 | 90 |
| SV003 | æŠ—è¡°ç´§è‡´ç–—ç¨‹ | skin_care | 899.00 | 120 |
| SV004 | å¤´çš®æ·±å±‚æŠ¤ç† | hair_care | 199.00 | 60 |
| SV005 | æŸ“çƒ«ä¿®å¤å¥—é¤ | hair_care | 399.00 | 90 |
| SV006 | å…¨èº«SPAæŠ¤ç† | spa | 699.00 | 120 |

---

## äº”ã€è®¢å•ç®¡ç†ç›¸å…³è¡¨

### 5.1 orders - è®¢å•è¡¨

**ç”¨é€”**ï¼šè®°å½•å®¢æˆ·çš„æœåŠ¡è®¢å•

**ç‰¹ç‚¹**ï¼š
- å®Œæ•´çš„è®¢å•ç”Ÿå‘½å‘¨æœŸ
- æ”¯ä»˜çŠ¶æ€è·Ÿè¸ª
- æœåŠ¡æ—¶é—´ç®¡ç†
- å†—ä½™å®¢æˆ·ä¿¡æ¯ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **order_no** | VARCHAR(50) | NO | - | è®¢å•ç¼–å·ï¼ˆå”¯ä¸€ï¼‰ |
| **customer_id** | BIGINT UNSIGNED | NO | - | å®¢æˆ·IDï¼ˆå¤–é”®ï¼‰ |
| **customer_name** | VARCHAR(50) | NO | - | å®¢æˆ·å§“åï¼ˆå†—ä½™ï¼‰ |
| **customer_phone** | VARCHAR(20) | NO | - | å®¢æˆ·ç”µè¯ï¼ˆå†—ä½™ï¼‰ |
| **org_id** | BIGINT UNSIGNED | NO | - | æ‰€å±æœºæ„IDï¼ˆå¤–é”®ï¼‰ |
| **store_id** | BIGINT UNSIGNED | NO | - | æ‰€å±é—¨åº—IDï¼ˆå¤–é”®ï¼‰ |
| **counselor_id** | BIGINT UNSIGNED | YES | NULL | é¡¾é—®ID |
| **beautician_id** | BIGINT UNSIGNED | YES | NULL | ç¾å®¹å¸ˆID |
| **original_amount** | DECIMAL(10,2) | NO | - | åŸå§‹é‡‘é¢ |
| **discount_amount** | DECIMAL(10,2) | NO | 0.00 | ä¼˜æƒ é‡‘é¢ |
| **final_amount** | DECIMAL(10,2) | NO | - | å®ä»˜é‡‘é¢ |
| **payment_method** | ENUM | YES | NULL | æ”¯ä»˜æ–¹å¼ |
| **payment_status** | ENUM | NO | unpaid | æ”¯ä»˜çŠ¶æ€ |
| **paid_amount** | DECIMAL(10,2) | NO | 0.00 | å·²ä»˜é‡‘é¢ |
| **paid_at** | TIMESTAMP | YES | NULL | æ”¯ä»˜æ—¶é—´ |
| **order_status** | ENUM | NO | pending | è®¢å•çŠ¶æ€ |
| **service_date** | DATE | YES | NULL | æœåŠ¡æ—¥æœŸ |
| **service_start_time** | TIME | YES | NULL | æœåŠ¡å¼€å§‹æ—¶é—´ |
| **service_end_time** | TIME | YES | NULL | æœåŠ¡ç»“æŸæ—¶é—´ |
| **remark** | TEXT | YES | NULL | è®¢å•å¤‡æ³¨ |
| **cancel_reason** | TEXT | YES | NULL | å–æ¶ˆåŸå›  |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| **updated_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| **created_by** | BIGINT UNSIGNED | YES | NULL | åˆ›å»ºäººID |
| **updated_by** | BIGINT UNSIGNED | YES | NULL | æ›´æ–°äººID |
| **is_deleted** | TINYINT(1) | NO | 0 | æ˜¯å¦åˆ é™¤ |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| order_no | å”¯ä¸€ç´¢å¼• | order_no | è®¢å•ç¼–å·å”¯ä¸€ |
| idx_customer_id | æ™®é€šç´¢å¼• | customer_id | æŒ‰å®¢æˆ·æŸ¥è¯¢ |
| idx_org_id | æ™®é€šç´¢å¼• | org_id | æŒ‰æœºæ„æŸ¥è¯¢ |
| idx_store_id | æ™®é€šç´¢å¼• | store_id | æŒ‰é—¨åº—æŸ¥è¯¢ |
| idx_order_status | æ™®é€šç´¢å¼• | order_status | æŒ‰è®¢å•çŠ¶æ€æŸ¥è¯¢ |
| idx_payment_status | æ™®é€šç´¢å¼• | payment_status | æŒ‰æ”¯ä»˜çŠ¶æ€æŸ¥è¯¢ |
| idx_service_date | æ™®é€šç´¢å¼• | service_date | æŒ‰æœåŠ¡æ—¥æœŸæŸ¥è¯¢ |
| idx_created_at | æ™®é€šç´¢å¼• | created_at | æŒ‰åˆ›å»ºæ—¶é—´æŸ¥è¯¢ |

#### å¤–é”®

| å¤–é”®å | å…³è”è¡¨ | å…³è”å­—æ®µ | åˆ é™¤è§„åˆ™ |
|-------|--------|---------|---------|
| fk_orders_customer | customers | customer_id â†’ id | RESTRICT |
| fk_orders_org | organizations | org_id â†’ id | RESTRICT |
| fk_orders_store | organizations | store_id â†’ id | RESTRICT |

#### æšä¸¾å€¼è¯´æ˜

**payment_method**ï¼ˆæ”¯ä»˜æ–¹å¼ï¼‰:
- `cash` - ç°é‡‘
- `wechat` - å¾®ä¿¡æ”¯ä»˜
- `alipay` - æ”¯ä»˜å®
- `card` - é“¶è¡Œå¡
- `membercard` - ä¼šå‘˜å¡
- `other` - å…¶ä»–

**payment_status**ï¼ˆæ”¯ä»˜çŠ¶æ€ï¼‰:
- `unpaid` - æœªæ”¯ä»˜
- `partial` - éƒ¨åˆ†æ”¯ä»˜
- `paid` - å·²æ”¯ä»˜
- `refunded` - å·²é€€æ¬¾

**order_status**ï¼ˆè®¢å•çŠ¶æ€ï¼‰:
- `pending` - å¾…ç¡®è®¤
- `confirmed` - å·²ç¡®è®¤
- `in_progress` - è¿›è¡Œä¸­
- `completed` - å·²å®Œæˆ
- `cancelled` - å·²å–æ¶ˆ
- `refunding` - é€€æ¬¾ä¸­
- `refunded` - å·²é€€æ¬¾

---

### 5.2 order_items - è®¢å•æ˜ç»†è¡¨

**ç”¨é€”**ï¼šè®°å½•è®¢å•åŒ…å«çš„æœåŠ¡é¡¹ç›®æ˜ç»†

**ç‰¹ç‚¹**ï¼š
- æ”¯æŒæ•°é‡å’ŒæŠ˜æ‰£
- å†—ä½™æœåŠ¡é¡¹ç›®åç§°
- è®°å½•æ‰§è¡Œç¾å®¹å¸ˆ

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **order_id** | BIGINT UNSIGNED | NO | - | è®¢å•IDï¼ˆå¤–é”®ï¼‰ |
| **org_id** | BIGINT UNSIGNED | NO | - | æ‰€å±æœºæ„ID |
| **service_id** | BIGINT UNSIGNED | NO | - | æœåŠ¡é¡¹ç›®ID |
| **service_name** | VARCHAR(100) | NO | - | æœåŠ¡é¡¹ç›®åç§°ï¼ˆå†—ä½™ï¼‰ |
| **service_category** | VARCHAR(50) | YES | NULL | æœåŠ¡ç±»åˆ«ï¼ˆå†—ä½™ï¼‰ |
| **unit_price** | DECIMAL(10,2) | NO | - | å•ä»· |
| **quantity** | INT UNSIGNED | NO | 1 | æ•°é‡ |
| **discount_rate** | DECIMAL(5,2) | NO | 0.00 | æŠ˜æ‰£ç‡(%) |
| **subtotal** | DECIMAL(10,2) | NO | - | å°è®¡ |
| **beautician_id** | BIGINT UNSIGNED | YES | NULL | æ‰§è¡Œç¾å®¹å¸ˆID |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| idx_order_id | æ™®é€šç´¢å¼• | order_id | æŒ‰è®¢å•æŸ¥è¯¢ |
| idx_service_id | æ™®é€šç´¢å¼• | service_id | æŒ‰æœåŠ¡æŸ¥è¯¢ |

#### å¤–é”®

| å¤–é”®å | å…³è”è¡¨ | å…³è”å­—æ®µ | åˆ é™¤è§„åˆ™ |
|-------|--------|---------|---------|
| fk_order_items_order | orders | order_id â†’ id | CASCADE |

---

## å…­ã€ä»»åŠ¡ç®¡ç†ç›¸å…³è¡¨

### 6.1 tasks - ä»»åŠ¡è¡¨

**ç”¨é€”**ï¼šç®¡ç†å¾…åŠä»»åŠ¡ï¼ˆå®¢æˆ·å›è®¿ã€ç”Ÿæ—¥å…³æ€€ç­‰ï¼‰

**ç‰¹ç‚¹**ï¼š
- æ”¯æŒå¤šç§ä»»åŠ¡ç±»å‹
- ä¼˜å…ˆçº§ç®¡ç†
- æé†’æ—¶é—´è®¾ç½®
- å…³è”å®¢æˆ·å’Œè®¢å•

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **task_no** | VARCHAR(50) | NO | - | ä»»åŠ¡ç¼–å·ï¼ˆå”¯ä¸€ï¼‰ |
| **title** | VARCHAR(200) | NO | - | ä»»åŠ¡æ ‡é¢˜ |
| **description** | TEXT | YES | NULL | ä»»åŠ¡æè¿° |
| **task_type** | ENUM | NO | - | ä»»åŠ¡ç±»å‹ |
| **priority** | ENUM | NO | medium | ä¼˜å…ˆçº§ |
| **customer_id** | BIGINT UNSIGNED | YES | NULL | å…³è”å®¢æˆ·IDï¼ˆå¤–é”®ï¼‰ |
| **order_id** | BIGINT UNSIGNED | YES | NULL | å…³è”è®¢å•ID |
| **org_id** | BIGINT UNSIGNED | NO | - | æ‰€å±æœºæ„ID |
| **assigned_to** | BIGINT UNSIGNED | NO | - | æ‰§è¡ŒäººIDï¼ˆå¤–é”®ï¼‰ |
| **assigned_by** | BIGINT UNSIGNED | YES | NULL | åˆ†é…äººID |
| **due_date** | DATE | YES | NULL | æˆªæ­¢æ—¥æœŸ |
| **reminder_time** | TIMESTAMP | YES | NULL | æé†’æ—¶é—´ |
| **completed_at** | TIMESTAMP | YES | NULL | å®Œæˆæ—¶é—´ |
| **status** | ENUM | NO | pending | ä»»åŠ¡çŠ¶æ€ |
| **completion_note** | TEXT | YES | NULL | å®Œæˆè¯´æ˜ |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| **updated_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| **created_by** | BIGINT UNSIGNED | YES | NULL | åˆ›å»ºäººID |
| **updated_by** | BIGINT UNSIGNED | YES | NULL | æ›´æ–°äººID |
| **is_deleted** | TINYINT(1) | NO | 0 | æ˜¯å¦åˆ é™¤ |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| task_no | å”¯ä¸€ç´¢å¼• | task_no | ä»»åŠ¡ç¼–å·å”¯ä¸€ |
| idx_customer_id | æ™®é€šç´¢å¼• | customer_id | æŒ‰å®¢æˆ·æŸ¥è¯¢ |
| idx_assigned_to | æ™®é€šç´¢å¼• | assigned_to | æŒ‰æ‰§è¡ŒäººæŸ¥è¯¢ |
| idx_org_id | æ™®é€šç´¢å¼• | org_id | æŒ‰æœºæ„æŸ¥è¯¢ |
| idx_status | æ™®é€šç´¢å¼• | status | æŒ‰çŠ¶æ€æŸ¥è¯¢ |
| idx_task_type | æ™®é€šç´¢å¼• | task_type | æŒ‰ç±»å‹æŸ¥è¯¢ |
| idx_due_date | æ™®é€šç´¢å¼• | due_date | æŒ‰æˆªæ­¢æ—¥æœŸæŸ¥è¯¢ |

#### å¤–é”®

| å¤–é”®å | å…³è”è¡¨ | å…³è”å­—æ®µ | åˆ é™¤è§„åˆ™ |
|-------|--------|---------|---------|
| fk_tasks_customer | customers | customer_id â†’ id | SET NULL |
| fk_tasks_user | users | assigned_to â†’ id | RESTRICT |

#### æšä¸¾å€¼è¯´æ˜

**task_type**ï¼ˆä»»åŠ¡ç±»å‹ï¼‰:
- `follow_up` - å®¢æˆ·å›è®¿
- `birthday` - ç”Ÿæ—¥å…³æ€€
- `feedback` - æ•ˆæœåé¦ˆ
- `complaint` - æŠ•è¯‰å¤„ç†
- `custom` - è‡ªå®šä¹‰

**priority**ï¼ˆä¼˜å…ˆçº§ï¼‰:
- `low` - ä½
- `medium` - ä¸­
- `high` - é«˜
- `urgent` - ç´§æ€¥

**status**ï¼ˆä»»åŠ¡çŠ¶æ€ï¼‰:
- `pending` - å¾…å¤„ç†
- `in_progress` - è¿›è¡Œä¸­
- `completed` - å·²å®Œæˆ
- `cancelled` - å·²å–æ¶ˆ
- `overdue` - å·²é€¾æœŸ

---

## ä¸ƒã€æ–¹æ¡ˆæ¨¡æ¿ç›¸å…³è¡¨

### 7.1 solution_templates - æ–¹æ¡ˆæ¨¡æ¿è¡¨

**ç”¨é€”**ï¼šå­˜å‚¨æŠ¤ç†æ–¹æ¡ˆæ¨¡æ¿ï¼Œç”¨äºå¿«é€Ÿåˆ¶å®šå®¢æˆ·æ–¹æ¡ˆ

**ç‰¹ç‚¹**ï¼š
- æ”¯æŒå…¨å±€å’Œæœºæ„çº§æ¨¡æ¿
- åŒ…å«é€‚ç”¨æ¡ä»¶
- è¯¦ç»†çš„æ­¥éª¤å’Œäº§å“æ¸…å•
- ä½¿ç”¨æ¬¡æ•°ç»Ÿè®¡

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **template_code** | VARCHAR(50) | NO | - | æ¨¡æ¿ç¼–ç  |
| **template_name** | VARCHAR(200) | NO | - | æ¨¡æ¿åç§° |
| **category** | ENUM | NO | - | æ–¹æ¡ˆç±»åˆ« |
| **org_id** | BIGINT UNSIGNED | YES | NULL | æ‰€å±æœºæ„IDï¼ˆNULL=å…¨å±€ï¼‰ |
| **scope** | ENUM | NO | org | å…±äº«èŒƒå›´ |
| **suitable_skin_types** | JSON | YES | NULL | é€‚ç”¨è‚¤è´¨ï¼ˆJSONæ•°ç»„ï¼‰ |
| **suitable_problems** | JSON | YES | NULL | é€‚ç”¨é—®é¢˜ï¼ˆJSONæ•°ç»„ï¼‰ |
| **target_group** | VARCHAR(100) | YES | NULL | ç›®æ ‡äººç¾¤ |
| **course_duration** | VARCHAR(50) | YES | NULL | ç–—ç¨‹æ—¶é•¿ |
| **treatment_frequency** | VARCHAR(50) | YES | NULL | æ²»ç–—é¢‘æ¬¡ |
| **steps** | JSON | YES | NULL | æ­¥éª¤è¯´æ˜ï¼ˆJSONæ•°ç»„ï¼‰ |
| **products** | JSON | YES | NULL | æ¨èäº§å“ï¼ˆJSONæ•°ç»„ï¼‰ |
| **services** | JSON | YES | NULL | åŒ…å«æœåŠ¡ï¼ˆJSONæ•°ç»„ï¼‰ |
| **expected_effects** | TEXT | YES | NULL | é¢„æœŸæ•ˆæœ |
| **precautions** | TEXT | YES | NULL | æ³¨æ„äº‹é¡¹ |
| **estimated_price_min** | DECIMAL(10,2) | YES | NULL | é¢„ä¼°ä»·æ ¼ä¸‹é™ |
| **estimated_price_max** | DECIMAL(10,2) | YES | NULL | é¢„ä¼°ä»·æ ¼ä¸Šé™ |
| **cover_image** | VARCHAR(255) | YES | NULL | å°é¢å›¾ |
| **case_photos** | JSON | YES | NULL | æ¡ˆä¾‹ç…§ç‰‡ï¼ˆJSONæ•°ç»„ï¼‰ |
| **usage_count** | INT UNSIGNED | NO | 0 | ä½¿ç”¨æ¬¡æ•° |
| **status** | ENUM | NO | active | çŠ¶æ€ï¼šactive/inactive |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| **updated_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| **created_by** | BIGINT UNSIGNED | YES | NULL | åˆ›å»ºäººID |
| **updated_by** | BIGINT UNSIGNED | YES | NULL | æ›´æ–°äººID |
| **is_deleted** | TINYINT(1) | NO | 0 | æ˜¯å¦åˆ é™¤ |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| uk_org_code | å”¯ä¸€ç´¢å¼• | (org_id, template_code) | æœºæ„å†…ç¼–ç å”¯ä¸€ |
| idx_category | æ™®é€šç´¢å¼• | category | æŒ‰ç±»åˆ«æŸ¥è¯¢ |
| idx_org_id | æ™®é€šç´¢å¼• | org_id | æŒ‰æœºæ„æŸ¥è¯¢ |
| idx_scope | æ™®é€šç´¢å¼• | scope | æŒ‰èŒƒå›´æŸ¥è¯¢ |
| idx_status | æ™®é€šç´¢å¼• | status | æŒ‰çŠ¶æ€æŸ¥è¯¢ |

#### æšä¸¾å€¼è¯´æ˜

**category**ï¼ˆæ–¹æ¡ˆç±»åˆ«ï¼‰:
- `hydration` - è¡¥æ°´ä¿æ¹¿
- `whitening` - ç¾ç™½æ·¡æ–‘
- `anti_aging` - æŠ—è¡°è€
- `repair` - ä¿®å¤
- `hair_care` - æ¯›å‘æŠ¤ç†
- `other` - å…¶ä»–

**scope**ï¼ˆå…±äº«èŒƒå›´ï¼‰:
- `global` - å…¨å±€ï¼ˆæ€»éƒ¨åˆ›å»ºï¼Œæ‰€æœ‰æœºæ„å¯ç”¨ï¼‰
- `org` - æœºæ„çº§ï¼ˆä»…æœ¬æœºæ„å¯ç”¨ï¼‰
- `private` - ç§æœ‰ï¼ˆä»…åˆ›å»ºè€…å¯ç”¨ï¼‰

**status**:
- `active` - å¯ç”¨
- `inactive` - åœç”¨

#### JSONå­—æ®µç¤ºä¾‹

**suitable_skin_types**ï¼ˆé€‚ç”¨è‚¤è´¨ï¼‰:
```json
["dry", "sensitive"]
```

**suitable_problems**ï¼ˆé€‚ç”¨é—®é¢˜ï¼‰:
```json
["wrinkles", "dryness", "dullness"]
```

**steps**ï¼ˆæ­¥éª¤è¯´æ˜ï¼‰:
```json
[
  {"step": 1, "name": "æ¸…æ´", "description": "æ¸©å’Œæ¸…æ´é¢éƒ¨", "duration": 10},
  {"step": 2, "name": "å»è§’è´¨", "description": "æ¸©å’Œå»è§’è´¨", "duration": 15},
  {"step": 3, "name": "è¡¥æ°´é¢è†œ", "description": "æ•·è¡¥æ°´é¢è†œ", "duration": 20},
  {"step": 4, "name": "ç²¾å", "description": "æ¶‚æŠ¹ç»å°¿é…¸ç²¾å", "duration": 5},
  {"step": 5, "name": "é¢éœœ", "description": "é”æ°´ä¿æ¹¿", "duration": 5}
]
```

**products**ï¼ˆæ¨èäº§å“ï¼‰:
```json
[
  {"name": "ç»å°¿é…¸ç²¾åæ¶²", "brand": "å“ç‰ŒA", "price": 299},
  {"name": "è¡¥æ°´é¢è†œ", "brand": "å“ç‰ŒB", "price": 199}
]
```

**services**ï¼ˆåŒ…å«æœåŠ¡ï¼‰:
```json
[
  {"service_id": 1, "service_name": "æ·±å±‚è¡¥æ°´æŠ¤ç†", "sessions": 8},
  {"service_id": 2, "service_name": "è¡¥æ°´é¢è†œ", "sessions": 4}
]
```

**case_photos**ï¼ˆæ¡ˆä¾‹ç…§ç‰‡ï¼‰:
```json
[
  "https://oss.example.com/templates/case1.jpg",
  "https://oss.example.com/templates/case2.jpg"
]
```

#### é¢„è®¾æ¨¡æ¿

| template_code | template_name | category | course_duration | treatment_frequency |
|--------------|---------------|----------|-----------------|-------------------|
| TPL001 | æ·±åº¦è¡¥æ°´ä¿æ¹¿æ–¹æ¡ˆ | hydration | 1ä¸ªæœˆ | æ¯å‘¨2æ¬¡ |
| TPL002 | ç¾ç™½æ·¡æ–‘ç„•è‚¤æ–¹æ¡ˆ | whitening | 3ä¸ªæœˆ | æ¯å‘¨1æ¬¡ |
| TPL003 | æŠ—è¡°ç´§è‡´æå‡æ–¹æ¡ˆ | anti_aging | 3ä¸ªæœˆ | æ¯å‘¨2æ¬¡ |
| TPL004 | å¤´çš®å…»æŠ¤æ–¹æ¡ˆ | hair_care | 2ä¸ªæœˆ | æ¯å‘¨1æ¬¡ |

---

## å…«ã€ç³»ç»Ÿæ—¥å¿—ç›¸å…³è¡¨

### 8.1 operation_logs - æ“ä½œæ—¥å¿—è¡¨

**ç”¨é€”**ï¼šè®°å½•ç³»ç»Ÿæ“ä½œå®¡è®¡æ—¥å¿—

**ç‰¹ç‚¹**ï¼š
- è®°å½•æ‰€æœ‰å…³é”®æ“ä½œ
- åŒ…å«è¯·æ±‚å’Œå“åº”ä¿¡æ¯
- è®°å½•IPå’Œç”¨æˆ·ä»£ç†
- æ€§èƒ½ç›‘æ§ï¼ˆå“åº”æ—¶é—´ï¼‰

#### è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| **id** | BIGINT UNSIGNED | NO | AUTO_INCREMENT | ä¸»é”®ID |
| **user_id** | BIGINT UNSIGNED | YES | NULL | æ“ä½œäººID |
| **username** | VARCHAR(50) | YES | NULL | æ“ä½œäººç”¨æˆ·åï¼ˆå†—ä½™ï¼‰ |
| **org_id** | BIGINT UNSIGNED | YES | NULL | æ‰€å±æœºæ„ID |
| **module** | VARCHAR(50) | NO | - | æ¨¡å—åç§° |
| **action** | VARCHAR(50) | NO | - | æ“ä½œç±»å‹ï¼ˆcreate/update/delete/viewï¼‰ |
| **description** | VARCHAR(500) | YES | NULL | æ“ä½œæè¿° |
| **request_method** | VARCHAR(10) | YES | NULL | è¯·æ±‚æ–¹æ³•ï¼ˆGET/POST/PUT/DELETEï¼‰ |
| **request_url** | VARCHAR(500) | YES | NULL | è¯·æ±‚URL |
| **request_params** | JSON | YES | NULL | è¯·æ±‚å‚æ•° |
| **response_status** | INT | YES | NULL | å“åº”çŠ¶æ€ç  |
| **response_time** | INT UNSIGNED | YES | NULL | å“åº”è€—æ—¶ï¼ˆmsï¼‰ |
| **ip_address** | VARCHAR(50) | YES | NULL | IPåœ°å€ |
| **user_agent** | VARCHAR(500) | YES | NULL | ç”¨æˆ·ä»£ç† |
| **created_at** | TIMESTAMP | NO | CURRENT_TIMESTAMP | æ“ä½œæ—¶é—´ |

#### ç´¢å¼•

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| idx_user_id | æ™®é€šç´¢å¼• | user_id | æŒ‰ç”¨æˆ·æŸ¥è¯¢ |
| idx_org_id | æ™®é€šç´¢å¼• | org_id | æŒ‰æœºæ„æŸ¥è¯¢ |
| idx_module | æ™®é€šç´¢å¼• | module | æŒ‰æ¨¡å—æŸ¥è¯¢ |
| idx_action | æ™®é€šç´¢å¼• | action | æŒ‰æ“ä½œç±»å‹æŸ¥è¯¢ |
| idx_created_at | æ™®é€šç´¢å¼• | created_at | æŒ‰æ—¶é—´æŸ¥è¯¢ |

#### æšä¸¾å€¼è¯´æ˜

**action**ï¼ˆæ“ä½œç±»å‹ï¼‰:
- `create` - åˆ›å»º
- `update` - æ›´æ–°
- `delete` - åˆ é™¤
- `view` - æŸ¥çœ‹
- `export` - å¯¼å‡º
- `login` - ç™»å½•
- `logout` - ç™»å‡º

**module**ï¼ˆæ¨¡å—åç§°ï¼‰:
- `customers` - å®¢æˆ·ç®¡ç†
- `orders` - è®¢å•ç®¡ç†
- `tasks` - ä»»åŠ¡ç®¡ç†
- `users` - ç”¨æˆ·ç®¡ç†
- `organizations` - æœºæ„ç®¡ç†
- `templates` - æ–¹æ¡ˆæ¨¡æ¿
- `cases` - å®¢æˆ·æ¡ˆä¾‹
- `settings` - ç³»ç»Ÿè®¾ç½®

#### JSONå­—æ®µç¤ºä¾‹

**request_params**ï¼ˆè¯·æ±‚å‚æ•°ï¼‰:
```json
{
  "customer_id": 123,
  "name": "å¼ ä¸‰",
  "phone": "13800138000"
}
```

---

## ä¹ã€è¡¨å…³ç³»å›¾

### 9.1 æ ¸å¿ƒå…³ç³»

```
organizations (1) â”€â”€< (N) organizations (è‡ªå…³è”)
organizations (1) â”€â”€< (N) users
organizations (1) â”€â”€< (N) customers
organizations (1) â”€â”€< (N) orders

users (N) â”€â”€< (M) roles â”€â”€< (M) permissions

customers (1) â”€â”€< (N) customer_diagnoses
customers (1) â”€â”€< (N) customer_cases
customers (1) â”€â”€< (N) orders
customers (1) â”€â”€< (N) tasks

orders (1) â”€â”€< (N) order_items
services (1) â”€â”€< (N) order_items

users (1) â”€â”€< (N) tasks
users (1) â”€â”€< (N) operation_logs
```

### 9.2 å¤–é”®ç»Ÿè®¡

| çˆ¶è¡¨ | å­è¡¨æ•°é‡ | è¯´æ˜ |
|-----|---------|------|
| organizations | 5 | users, customers, orders, services, solution_templates |
| users | 5 | customers, tasks, diagnoses, operation_logs |
| customers | 4 | diagnoses, cases, orders, tasks |
| orders | 1 | order_items |
| roles | 2 | user_roles, role_permissions |
| permissions | 1 | role_permissions |

---

## åã€æ•°æ®å­—å…¸æ‘˜è¦

### 10.1 é€šç”¨å­—æ®µè¯´æ˜

æ‰€æœ‰è¡¨éƒ½åŒ…å«ä»¥ä¸‹å®¡è®¡å­—æ®µï¼š

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|-------|------|------|
| **created_at** | TIMESTAMP | åˆ›å»ºæ—¶é—´ï¼ˆè‡ªåŠ¨ï¼‰ |
| **updated_at** | TIMESTAMP | æ›´æ–°æ—¶é—´ï¼ˆè‡ªåŠ¨ï¼‰ |
| **created_by** | BIGINT UNSIGNED | åˆ›å»ºäººID |
| **updated_by** | BIGINT UNSIGNED | æ›´æ–°äººIDï¼ˆéƒ¨åˆ†è¡¨ï¼‰ |
| **is_deleted** | TINYINT(1) | è½¯åˆ é™¤æ ‡è®°ï¼š0-å¦/1-æ˜¯ |

### 10.2 å‘½åè§„èŒƒ

**è¡¨å**ï¼š
- å°å†™å­—æ¯+ä¸‹åˆ’çº¿
- å¤æ•°å½¢å¼ï¼ˆå¦‚ customers, ordersï¼‰
- å…³è”è¡¨ä½¿ç”¨ä¸¤è¡¨åç»„åˆï¼ˆå¦‚ user_rolesï¼‰

**å­—æ®µå**ï¼š
- å°å†™å­—æ¯+ä¸‹åˆ’çº¿
- ä¸»é”®ç»Ÿä¸€ä¸º `id`
- å¤–é”®æ ¼å¼ä¸º `xxx_id`ï¼ˆå¦‚ org_id, user_idï¼‰
- å¸ƒå°”å‹å­—æ®µä½¿ç”¨ `is_` å‰ç¼€

**æšä¸¾å€¼**ï¼š
- å°å†™å­—æ¯+ä¸‹åˆ’çº¿
- è¯­ä¹‰æ¸…æ™°ï¼ˆå¦‚ active/inactiveï¼‰

### 10.3 ç´¢å¼•è§„èŒƒ

| ç´¢å¼•ç±»å‹ | å‘½åæ ¼å¼ | ç¤ºä¾‹ |
|---------|---------|------|
| ä¸»é”® | PRIMARY | PRIMARY KEY (id) |
| å”¯ä¸€ç´¢å¼• | uk_å­—æ®µå | uk_username, uk_org_code |
| æ™®é€šç´¢å¼• | idx_å­—æ®µå | idx_org_id, idx_status |
| å¤åˆç´¢å¼• | idx_å­—æ®µ1_å­—æ®µ2 | idx_org_id_status |

---

## é™„å½•

### A. SQLè„šæœ¬ä½ç½®

å®Œæ•´çš„æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼š
- **æ–‡ä»¶è·¯å¾„**ï¼š`database/init.sql`
- **å¤§å°**ï¼š33KB
- **åŒ…å«å†…å®¹**ï¼š
  - æ•°æ®åº“åˆ›å»º
  - 15å¼ è¡¨ç»“æ„
  - åˆå§‹æ•°æ®
  - ç´¢å¼•å’Œå¤–é”®

### B. ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£åç§° | è·¯å¾„ | è¯´æ˜ |
|---------|------|------|
| æ•°æ®åº“åˆå§‹åŒ–æŒ‡å— | database/README.md | å¦‚ä½•åˆå§‹åŒ–æ•°æ®åº“ |
| ERå›¾è®¾è®¡ | docs/ERå›¾è®¾è®¡.md | Mermaidæ ¼å¼ERå›¾ |
| ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ | docs/ç³»ç»Ÿè®¾è®¡.md | å®Œæ•´ç³»ç»Ÿè®¾è®¡ |
| éœ€æ±‚åˆ†ææ–‡æ¡£ | docs/éœ€æ±‚åˆ†æ.md | ä¸šåŠ¡éœ€æ±‚åˆ†æ |

### C. æ•°æ®ä¼°ç®—

**3å¹´æ•°æ®é‡ä¼°ç®—**ï¼š

| è¡¨å | é¢„ä¼°è¡Œæ•° | å¹´å¢é•¿ |
|-----|---------|--------|
| organizations | 750 | 250/å¹´ |
| users | 3,000 | 1000/å¹´ |
| customers | 150,000 | 50000/å¹´ |
| orders | 1,500,000 | 500000/å¹´ |
| order_items | 3,000,000 | 1000000/å¹´ |
| tasks | 600,000 | 200000/å¹´ |
| operation_logs | 10,000,000+ | å¯æŒ‰æœˆå½’æ¡£ |

### D. æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **è®¢å•è¡¨ä¼˜åŒ–**ï¼ˆè¶…è¿‡100ä¸‡æ¡æ—¶ï¼‰ï¼š
   - æŒ‰å¹´ä»½åˆ†åŒº
   - å†å²æ•°æ®å½’æ¡£
   - è¯»å†™åˆ†ç¦»

2. **æ—¥å¿—è¡¨ä¼˜åŒ–**ï¼š
   - æŒ‰æœˆåˆ†è¡¨
   - å®šæœŸå½’æ¡£
   - ä¿ç•™è¿‘3ä¸ªæœˆåœ¨çº¿æ•°æ®

3. **ç´¢å¼•ä¼˜åŒ–**ï¼š
   - å¤åˆç´¢å¼•éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™
   - é¿å…è¿‡å¤šç´¢å¼•å½±å“å†™å…¥æ€§èƒ½
   - å®šæœŸåˆ†ææ…¢æŸ¥è¯¢ä¼˜åŒ–ç´¢å¼•

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-12-01
**ç»´æŠ¤å›¢é˜Ÿ**: ç¾ä¸šCRMå¼€å‘å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2025-12-01
