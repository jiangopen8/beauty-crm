# æ¨¡å—åŒ–é‡æ„ - æµ‹è¯•ä¸å®Œå–„æŒ‡å—

## ğŸ§ª å¦‚ä½•æµ‹è¯•æ¡†æ¶

### 1. å¯åŠ¨æµ‹è¯•

```bash
# ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œ
npm run dev

# æˆ–è€…åœ¨ç”Ÿäº§ç¯å¢ƒ
pm2 list
```

### 2. è®¿é—®æµ‹è¯•é¡µé¢

**æœ¬åœ°ç¯å¢ƒ**ï¼š
```
http://localhost:5002/customer-detail-v2.html?id=1
```

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
```
http://8.210.246.101:5002/customer-detail-v2.html?id=1
```

### 3. éªŒè¯å„æ¨¡å—æ¡†æ¶

ä¾æ¬¡ç‚¹å‡»æ¯ä¸ªTabï¼ŒéªŒè¯æ¨¡å—åŠ è½½ï¼š

#### âœ… å®¢æˆ·èµ„æ–™ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰
- è¡¨å•æ­£å¸¸æ˜¾ç¤º
- æ•°æ®æ­£å¸¸åŠ è½½å’Œä¿å­˜
- å­—æ®µåˆ†ç»„æ¸…æ™°
- éªŒè¯åŠŸèƒ½å®Œæ•´

#### ğŸ”§ è¯Šæ–­ç®¡ç†ï¼ˆæ¡†æ¶å®Œæˆï¼‰
- æ˜¾ç¤º"è¯Šæ–­ç®¡ç†"æ ‡é¢˜
- "æ–°å»ºè¯Šæ–­"æŒ‰é’®å­˜åœ¨
- æ˜¾ç¤ºç©ºçŠ¶æ€æç¤º
- æ§åˆ¶å°è¾“å‡ºï¼š`âœ… DiagnosisModule æ¨¡å—æ¡†æ¶å·²åŠ è½½`

#### ğŸ”§ æ–¹æ¡ˆç®¡ç†ï¼ˆæ¡†æ¶å®Œæˆï¼‰
- æ˜¾ç¤º"æ–¹æ¡ˆç®¡ç†"æ ‡é¢˜
- "AIç”Ÿæˆæ–¹æ¡ˆ"å’Œ"æ–°å»ºæ–¹æ¡ˆ"æŒ‰é’®å­˜åœ¨
- æ˜¾ç¤ºç©ºçŠ¶æ€æç¤º
- æ§åˆ¶å°è¾“å‡ºï¼š`âœ… PlansModule æ¨¡å—æ¡†æ¶å·²åŠ è½½`

#### ğŸ”§ è®¢å•ç®¡ç†ï¼ˆæ¡†æ¶å®Œæˆï¼‰
- æ˜¾ç¤º"è®¢å•ç®¡ç†"æ ‡é¢˜
- è®¢å•ç»Ÿè®¡å¡ç‰‡å±•ç¤ºï¼ˆ4ä¸ªç»Ÿè®¡é¡¹ï¼‰
- ç­›é€‰å™¨æ˜¾ç¤ºï¼ˆçŠ¶æ€ã€æ—¶é—´ï¼‰
- æ˜¾ç¤ºç©ºçŠ¶æ€æç¤º
- æ§åˆ¶å°è¾“å‡ºï¼š`âœ… OrdersModule æ¨¡å—æ¡†æ¶å·²åŠ è½½`

#### ğŸ”§ ä»»åŠ¡ç®¡ç†ï¼ˆæ¡†æ¶å®Œæˆï¼‰
- æ˜¾ç¤º"ä»»åŠ¡ç®¡ç†"æ ‡é¢˜
- ä»»åŠ¡ç»Ÿè®¡å¡ç‰‡å±•ç¤ºï¼ˆ4ä¸ªç»Ÿè®¡é¡¹ï¼‰
- çŠ¶æ€ç­›é€‰æ ‡ç­¾ï¼ˆå…¨éƒ¨ã€è¿›è¡Œä¸­ã€å·²å®Œæˆã€å·²é€¾æœŸï¼‰
- æ˜¾ç¤ºç©ºçŠ¶æ€æç¤º
- æ§åˆ¶å°è¾“å‡ºï¼š`âœ… TasksModule æ¨¡å—æ¡†æ¶å·²åŠ è½½`

#### ğŸ”§ AIå¯¹è¯è®°å½•ï¼ˆæ¡†æ¶å®Œæˆï¼‰
- æ˜¾ç¤º"AIå¯¹è¯è®°å½•"æ ‡é¢˜
- å¯¹è¯ç»Ÿè®¡å¡ç‰‡å±•ç¤ºï¼ˆ4ä¸ªç»Ÿè®¡é¡¹ï¼‰
- æœç´¢æ¡†å­˜åœ¨
- ä¸¤æ å¸ƒå±€ï¼ˆå¯¹è¯åˆ—è¡¨ + å¯¹è¯è¯¦æƒ…ï¼‰
- æ˜¾ç¤ºç©ºçŠ¶æ€æç¤º
- æ§åˆ¶å°è¾“å‡ºï¼š`âœ… ChatModule æ¨¡å—æ¡†æ¶å·²åŠ è½½`

---

## ğŸ”§ å¦‚ä½•å®Œå–„æ¨¡å—

### é€šç”¨æ­¥éª¤

æ¯ä¸ªæ¨¡å—çš„å®Œå–„æµç¨‹ç±»ä¼¼ï¼Œä»¥ä¸‹æ˜¯æ ‡å‡†æµç¨‹ï¼š

#### ç¬¬1æ­¥ï¼šåˆ›å»ºåç«¯API

```javascript
// ç¤ºä¾‹ï¼šè¯Šæ–­ç®¡ç†API
// api/routes/diagnosis.js

const express = require('express');
const router = express.Router();
const { getPool } = require('../config/db');

// è·å–å®¢æˆ·è¯Šæ–­åˆ—è¡¨
router.get('/customer/:customerId', async (req, res) => {
    try {
        const pool = getPool();
        const [rows] = await pool.query(
            'SELECT * FROM customer_diagnosis WHERE customer_id = ? ORDER BY created_at DESC',
            [req.params.customerId]
        );
        res.json({ success: true, data: rows });
    } catch (error) {
        console.error('è·å–è¯Šæ–­åˆ—è¡¨å¤±è´¥:', error);
        res.status(500).json({ success: false, message: error.message });
    }
});

// åˆ›å»ºè¯Šæ–­è®°å½•
router.post('/', async (req, res) => {
    // å®ç°åˆ›å»ºé€»è¾‘
});

module.exports = router;
```

#### ç¬¬2æ­¥ï¼šæ³¨å†ŒAPIè·¯ç”±

```javascript
// api/server.js
const diagnosisRoutes = require('./routes/diagnosis');
app.use('/api/diagnosis', diagnosisRoutes);
```

#### ç¬¬3æ­¥ï¼šå®Œå–„å‰ç«¯æ¨¡å—

ä¿®æ”¹å¯¹åº”çš„æ¨¡å—æ–‡ä»¶ï¼Œä¾‹å¦‚ `js/modules/diagnosis.js`ï¼š

```javascript
// å°† TODO æ³¨é‡Šçš„éƒ¨åˆ†æ›¿æ¢ä¸ºçœŸå®å®ç°

async loadDiagnosisList() {
    try {
        // æ›¿æ¢è¿™éƒ¨åˆ†
        const response = await fetch(`http://8.210.246.101:3000/api/diagnosis/customer/${this.customerId}`);
        const result = await response.json();
        if (result.success) {
            this.diagnosisList = result.data;
            console.log('âœ… è¯Šæ–­åˆ—è¡¨åŠ è½½æˆåŠŸ');
        }
    } catch (error) {
        console.error('åŠ è½½è¯Šæ–­åˆ—è¡¨å¤±è´¥:', error);
    }
}

renderDiagnosisList() {
    if (this.diagnosisList.length === 0) {
        // ä¿æŒç°æœ‰çš„ç©ºçŠ¶æ€æç¤º
        return `...`;
    }

    // æ·»åŠ å®é™…æ¸²æŸ“é€»è¾‘
    return this.diagnosisList.map(diagnosis => `
        <div class="diagnosis-card bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow cursor-pointer"
             onclick="viewDiagnosis(${diagnosis.id})">
            <div class="flex items-center justify-between mb-2">
                <h5 class="font-semibold text-gray-900">${diagnosis.title || 'è¯Šæ–­è®°å½•'}</h5>
                <span class="text-xs text-gray-500">${new Date(diagnosis.created_at).toLocaleDateString('zh-CN')}</span>
            </div>
            <p class="text-sm text-gray-600 line-clamp-2">${diagnosis.content || 'æš‚æ— æè¿°'}</p>
        </div>
    `).join('');
}
```

#### ç¬¬4æ­¥ï¼šæµ‹è¯•éªŒè¯

1. é‡å¯æœåŠ¡å™¨ï¼ˆå¦‚æœä¿®æ”¹äº†åç«¯ï¼‰
2. åˆ·æ–°é¡µé¢
3. éªŒè¯æ•°æ®åŠ è½½
4. éªŒè¯äº¤äº’åŠŸèƒ½
5. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

---

## ğŸ“‹ å„æ¨¡å—å®Œå–„ä¼˜å…ˆçº§å’Œå»ºè®®

### P0 - è®¢å•ç®¡ç† â­â­â­â­â­

**ä¸ºä»€ä¹ˆä¼˜å…ˆ**ï¼š
- ä¸šåŠ¡æ ¸å¿ƒåŠŸèƒ½
- æ¶‰åŠæ”¯ä»˜å’Œæ”¶å…¥
- ç”¨æˆ·æœ€å…³å¿ƒçš„æ•°æ®

**éœ€è¦å®ç°çš„åŠŸèƒ½**ï¼š
1. âœ… è®¢å•åˆ—è¡¨åŠ è½½ï¼ˆä»æ•°æ®åº“ï¼‰
2. âœ… è®¢å•ç»Ÿè®¡è®¡ç®—ï¼ˆæ€»é‡‘é¢ã€è®¢å•æ•°ç­‰ï¼‰
3. âœ… è®¢å•ç­›é€‰ï¼ˆçŠ¶æ€ã€æ—¶é—´ï¼‰
4. âœ… åˆ›å»ºè®¢å•è¡¨å•
5. âœ… è®¢å•æ”¯ä»˜æµç¨‹

**æ•°æ®åº“è¡¨**ï¼š`orders` è¡¨å·²å­˜åœ¨

**APIè·¯å¾„**ï¼š`/api/orders/*`

**é¢„è®¡æ—¶é—´**ï¼š2-3å°æ—¶

---

### P1 - è¯Šæ–­ç®¡ç† â­â­â­â­

**ä¸ºä»€ä¹ˆé‡è¦**ï¼š
- ç¾å®¹ä¸šåŠ¡æ ¸å¿ƒ
- ä¸æ–¹æ¡ˆç®¡ç†ç´§å¯†å…³è”
- éœ€è¦å…ˆæœ‰è¯Šæ–­æ‰èƒ½ç”Ÿæˆæ–¹æ¡ˆ

**éœ€è¦å®ç°çš„åŠŸèƒ½**ï¼š
1. âœ… è¯Šæ–­åˆ—è¡¨å±•ç¤º
2. âœ… åˆ›å»ºè¯Šæ–­è®°å½•
3. âœ… è¯Šæ–­æ¨¡æ¿é€‰æ‹©
4. âœ… è¯Šæ–­å›¾ç‰‡ä¸Šä¼ ï¼ˆå¯é€‰ï¼‰
5. âœ… ç¼–è¾‘/åˆ é™¤è¯Šæ–­

**æ•°æ®åº“è¡¨**ï¼šéœ€è¦åˆ›å»º `customer_diagnosis` è¡¨

**APIè·¯å¾„**ï¼š`/api/diagnosis/*`

**é¢„è®¡æ—¶é—´**ï¼š3-4å°æ—¶

---

### P1 - æ–¹æ¡ˆç®¡ç† â­â­â­â­

**ä¸ºä»€ä¹ˆé‡è¦**ï¼š
- ä¸è¯Šæ–­é…å¥—ä½¿ç”¨
- åŒ…å«AIç”ŸæˆåŠŸèƒ½ï¼ˆäº®ç‚¹ï¼‰
- æå‡ç”¨æˆ·ä½“éªŒ

**éœ€è¦å®ç°çš„åŠŸèƒ½**ï¼š
1. âœ… æ–¹æ¡ˆåˆ—è¡¨å±•ç¤º
2. âœ… æ–¹æ¡ˆæ¨¡æ¿åŠ è½½ï¼ˆå·²æœ‰APIï¼‰
3. âœ… åˆ›å»ºæ–¹æ¡ˆ
4. âœ… ç¼–è¾‘æ–¹æ¡ˆ
5. âœ… AIç”Ÿæˆæ–¹æ¡ˆï¼ˆé‡ç‚¹åŠŸèƒ½ï¼‰

**æ•°æ®åº“è¡¨**ï¼šéœ€è¦åˆ›å»ºæˆ–ä½¿ç”¨ç°æœ‰æ–¹æ¡ˆè¡¨

**APIè·¯å¾„**ï¼š
- `/api/solution-templates` - å·²å­˜åœ¨
- `/api/plans/*` - éœ€è¦åˆ›å»º

**é¢„è®¡æ—¶é—´**ï¼š4-5å°æ—¶ï¼ˆå«AIåŠŸèƒ½ï¼‰

---

### P2 - ä»»åŠ¡ç®¡ç† â­â­â­

**ä¸ºä»€ä¹ˆæ¬¡è¦**ï¼š
- å†…éƒ¨å·¥å…·æ€§è´¨
- æå‡è¿è¥æ•ˆç‡
- ä¸ç›´æ¥å½±å“å®¢æˆ·ä½“éªŒ

**éœ€è¦å®ç°çš„åŠŸèƒ½**ï¼š
1. âœ… ä»»åŠ¡åˆ—è¡¨å±•ç¤º
2. âœ… ä»»åŠ¡çŠ¶æ€ç­›é€‰
3. âœ… åˆ›å»ºä»»åŠ¡
4. âœ… å®Œæˆ/å–æ¶ˆä»»åŠ¡
5. âœ… ä»»åŠ¡æé†’ï¼ˆå¯é€‰ï¼‰

**æ•°æ®åº“è¡¨**ï¼š`customer_tasks` æˆ– `tasks` è¡¨

**APIè·¯å¾„**ï¼š`/api/tasks/*`

**é¢„è®¡æ—¶é—´**ï¼š2-3å°æ—¶

---

### P2 - AIå¯¹è¯è®°å½• â­â­â­

**ä¸ºä»€ä¹ˆæ¬¡è¦**ï¼š
- å†å²è®°å½•æŸ¥çœ‹
- æ•°æ®åˆ†æç”¨é€”
- éæ ¸å¿ƒä¸šåŠ¡æµç¨‹

**éœ€è¦å®ç°çš„åŠŸèƒ½**ï¼š
1. âœ… å¯¹è¯å†å²å±•ç¤º
2. âœ… å¯¹è¯è¯¦æƒ…æŸ¥çœ‹
3. âœ… å¯¹è¯æœç´¢
4. âœ… å‘èµ·æ–°å¯¹è¯ï¼ˆå¯é€‰ï¼‰
5. âœ… ç»Ÿè®¡åˆ†æ

**æ•°æ®åº“è¡¨**ï¼šéœ€è¦åˆ›å»º `chat_history` æˆ– `ai_conversations` è¡¨

**APIè·¯å¾„**ï¼š`/api/chat/*`

**é¢„è®¡æ—¶é—´**ï¼š3-4å°æ—¶

---

## ğŸ¯ å®Œå–„å»ºè®®

### æ¸è¿›å¼å¼€å‘ç­–ç•¥

**ç¬¬ä¸€å‘¨ï¼šæ ¸å¿ƒåŠŸèƒ½**
- Day 1-2: è®¢å•ç®¡ç†ï¼ˆå®Œæ•´å®ç°ï¼‰
- Day 3-4: è¯Šæ–­ç®¡ç†ï¼ˆå®Œæ•´å®ç°ï¼‰
- Day 5: æµ‹è¯•å’Œä¿®å¤bug

**ç¬¬äºŒå‘¨ï¼šæ‰©å±•åŠŸèƒ½**
- Day 1-2: æ–¹æ¡ˆç®¡ç†ï¼ˆå«AIç”Ÿæˆï¼‰
- Day 3: ä»»åŠ¡ç®¡ç†
- Day 4: AIå¯¹è¯è®°å½•
- Day 5: æ•´ä½“æµ‹è¯•å’Œä¼˜åŒ–

### å¹¶è¡Œå¼€å‘å»ºè®®

å¦‚æœæœ‰å¤šäººåä½œï¼š
- ğŸ‘¤ å¼€å‘è€…Aï¼šè®¢å•ç®¡ç† + ä»»åŠ¡ç®¡ç†
- ğŸ‘¤ å¼€å‘è€…Bï¼šè¯Šæ–­ç®¡ç† + æ–¹æ¡ˆç®¡ç†
- ğŸ‘¤ å¼€å‘è€…Cï¼šAIå¯¹è¯è®°å½• + æ•´ä½“ä¼˜åŒ–

æ¯ä¸ªæ¨¡å—ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ï¼Œéå¸¸é€‚åˆå¹¶è¡Œå¼€å‘ï¼

---

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

### åŠŸèƒ½å®Œæˆæ ‡å‡†

æ¯ä¸ªæ¨¡å—å®Œæˆåï¼Œåº”æ»¡è¶³ï¼š

- [ ] APIæ¥å£å®Œæ•´ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- [ ] åˆ—è¡¨æ•°æ®æ­£ç¡®åŠ è½½
- [ ] åˆ›å»ºåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] ç¼–è¾‘åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] åˆ é™¤åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼ˆå¦‚æœ‰ï¼‰
- [ ] ç­›é€‰/æœç´¢åŠŸèƒ½æ­£å¸¸
- [ ] ç»Ÿè®¡æ•°æ®å‡†ç¡®
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] åŠ è½½çŠ¶æ€æ˜¾ç¤º
- [ ] æ§åˆ¶å°æ— é”™è¯¯
- [ ] ç§»åŠ¨ç«¯é€‚é…è‰¯å¥½

### ä»£ç è´¨é‡æ ‡å‡†

- [ ] ä»£ç æ³¨é‡Šæ¸…æ™°
- [ ] å˜é‡å‘½åè§„èŒƒ
- [ ] æ— console.logæ®‹ç•™ï¼ˆé™¤å¿…è¦æ—¥å¿—ï¼‰
- [ ] å¼‚æ­¥æ“ä½œæœ‰é”™è¯¯å¤„ç†
- [ ] ç”¨æˆ·äº¤äº’æœ‰åé¦ˆ
- [ ] æ•°æ®éªŒè¯å®Œæ•´

---

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹ç¤ºä¾‹

### ç¤ºä¾‹ï¼šå®Œå–„è¯Šæ–­ç®¡ç†æ¨¡å—

**1. åˆ›å»ºæ•°æ®åº“è¡¨**

```sql
CREATE TABLE customer_diagnosis (
    id INT PRIMARY KEY AUTO_INCREMENT,
    customer_id INT NOT NULL,
    title VARCHAR(200) NOT NULL,
    content TEXT,
    diagnosis_date DATE,
    images JSON,
    created_by INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);
```

**2. åˆ›å»ºAPI**

```javascript
// api/routes/diagnosis.js
router.get('/customer/:customerId', async (req, res) => {
    const pool = getPool();
    const [rows] = await pool.query(
        'SELECT * FROM customer_diagnosis WHERE customer_id = ? ORDER BY created_at DESC',
        [req.params.customerId]
    );
    res.json({ success: true, data: rows });
});
```

**3. ä¿®æ”¹å‰ç«¯æ¨¡å—**

```javascript
// js/modules/diagnosis.js
async loadDiagnosisList() {
    const response = await fetch(`http://8.210.246.101:3000/api/diagnosis/customer/${this.customerId}`);
    const result = await response.json();
    if (result.success) {
        this.diagnosisList = result.data;
    }
}
```

**4. æµ‹è¯•**

è®¿é—®é¡µé¢ â†’ ç‚¹å‡»"è¯Šæ–­ç®¡ç†"Tab â†’ æŸ¥çœ‹æ•°æ®åŠ è½½

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

æ¯ä¸ªæ¨¡å—å®Œå–„æ—¶ï¼Œå¯ä»¥ï¼š

1. å‚è€ƒå·²å®Œæˆçš„"å®¢æˆ·èµ„æ–™"æ¨¡å—
2. æŸ¥çœ‹æ¡†æ¶ä¸­çš„TODOæ³¨é‡Š
3. æ£€æŸ¥APIæ–‡æ¡£
4. è¿è¡Œæµ‹è¯•éªŒè¯

**ç¥ä½ å®Œå–„é¡ºåˆ©ï¼** ğŸ‰
